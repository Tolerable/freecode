<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>CULT MANUAL: Exit Cost</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@400;500&display=swap" rel="stylesheet"/>

<style>
:root {
  --bg: #0a0705;
  --panel: #141110;
  --panel-light: #1d1815;
  --accent: #e8c66a;        /* candle gold */
  --accent-soft: rgba(232,198,106,0.15);
  --accent-glow: 0 0 12px rgba(232,198,106,0.5);
  --blood: #681919;         /* ritual red */
  --text: #f5f2e8;
  --muted: #9a9382;
  --line: #3a2f22;
  --radius-lg: 18px;
  --radius-md: 10px;
  --radius-sm: 6px;
  --font-head: 'Cinzel', serif;
  --font-body: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* BASE */
* {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
}

body {
  margin: 0;
  background:
    radial-gradient(circle at 20% 15%, rgba(80,40,20,0.28) 0%, rgba(0,0,0,0) 70%),
    radial-gradient(circle at 80% 80%, rgba(232,198,106,0.08) 0%, rgba(0,0,0,0) 70%),
    #000000;
  color: var(--text);
  font-family: var(--font-body);
  display: flex;
  flex-direction: row;
  min-height: 100vh;
  overflow-x: hidden;
  overflow-y: auto;
  line-height: 1.45;
  padding-top: 58px;
}

/* TOP NAV BAR */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: rgba(10,7,5,0.92);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(255,255,255,0.07);
  z-index: 9999;
  box-shadow: 0 20px 30px rgba(0,0,0,0.95);
  font-family: var(--font-head);
}

.nav-inner {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 14px 20px;
  padding: 12px 16px;
  max-width: 1400px;
  margin: 0 auto;
}

.nav-brand {
  color: var(--accent);
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.06em;
  text-shadow: 0 0 8px rgba(232,198,106,0.6), 0 0 24px rgba(232,198,106,0.4);
  white-space: nowrap;
}

.nav-links {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px 16px;
  font-size: 0.7rem;
  letter-spacing: 0.04em;
}

.nav-link {
  color: var(--text);
  text-decoration: none;
  padding-bottom: 2px;
  border-bottom: 2px solid transparent;
}
.nav-link.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
  text-shadow: 0 0 12px rgba(232,198,106,0.6);
}
.nav-link:hover {
  color: var(--accent);
  text-shadow: 0 0 12px rgba(232,198,106,0.6);
}

/* SIDEBAR */
#sidebar {
  width: 270px;
  background:
    radial-gradient(circle at 0% 0%, rgba(104,25,25,0.35) 0%, rgba(0,0,0,0) 60%),
    radial-gradient(circle at 100% 0%, rgba(232,198,106,0.07) 0%, rgba(0,0,0,0) 70%),
    #0a0705;
  border-right: 1px solid var(--line);
  display: flex;
  flex-direction: column;
  box-shadow: 8px 0 24px rgba(0,0,0,0.9);
  position: relative;
  z-index: 10;
}

.sidebar-header {
  padding: 20px 16px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  background: radial-gradient(circle at 20% 20%, rgba(232,198,106,0.12) 0%, rgba(0,0,0,0) 70%);
}

.app-title {
  font-family: var(--font-head);
  font-size: 1rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  color: var(--text);
  display: flex;
  flex-direction: column;
  gap: 4px;
  text-shadow: 0 0 6px rgba(232,198,106,0.5);
}

.app-mainline {
  display: flex;
  flex-wrap: wrap;
  column-gap: 8px;
  row-gap: 4px;
  align-items: baseline;
}

.app-mainline span:first-child {
  color: var(--text);
}

.section-subtitle {
  color: var(--accent);
  font-size: 0.7rem;
  font-weight: 500;
  text-shadow: 0 0 8px rgba(232,198,106,0.6);
  letter-spacing: 0.07em;
  white-space: nowrap;
}

.app-sub {
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--muted);
  line-height: 1.4;
  margin-top: 6px;
}

.search-wrap {
  margin-top: 16px;
  position: relative;
}

.search-wrap input {
  width: 100%;
  background: rgba(0,0,0,0.4);
  border: 1px solid var(--line);
  border-radius: var(--radius-md);
  color: var(--text);
  font-size: 0.8rem;
  padding: 9px 10px 9px 30px;
  outline: none;
  box-shadow:
    inset 0 0 10px rgba(232,198,106,0.25),
    0 0 12px rgba(104,25,25,0.4);
}
.search-wrap input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 8px rgba(232,198,106,0.6),
              inset 0 0 10px rgba(232,198,106,0.3),
              0 0 18px rgba(104,25,25,0.5);
}
.search-icon {
  position: absolute;
  left: 9px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.7rem;
  color: var(--accent);
  text-shadow: 0 0 12px rgba(232,198,106,0.6);
  pointer-events: none;
}

/* EXIT LIST */
.exit-list {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px 0 80px;
  scrollbar-width: thin;
  scrollbar-color: var(--accent) #000;
}
.exit-list::-webkit-scrollbar {
  width: 6px;
}
.exit-list::-webkit-scrollbar-track {
  background: #000;
}
.exit-list::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
  box-shadow: 0 0 10px rgba(232,198,106,0.7);
}

.exit-item {
  padding: 10px 16px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
  position: relative;
  transition: background 0.12s;
  display: flex;
  flex-direction: column;
}
.exit-item:hover {
  background: rgba(232,198,106,0.08);
}
.exit-item.active {
  background: rgba(232,198,106,0.16);
  box-shadow: inset 0 0 12px rgba(232,198,106,0.6);
}

/* stacked title+pill */
.exit-line1 {
  display: block;
}

.exit-name {
  font-family: var(--font-head);
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text);
  letter-spacing: 0.04em;
  display: block;
  margin-bottom: 6px;
  max-width: 100%;
  word-break: break-word;
  text-shadow: 0 0 8px rgba(104,25,25,0.6);
}

.exit-tag {
  background: var(--accent);
  color: #000;
  font-size: 0.6rem;
  font-weight: 600;
  line-height: 1.2;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  white-space: nowrap;
  box-shadow:
    0 0 8px rgba(232,198,106,0.6),
    0 0 20px rgba(104,25,25,0.6);
  margin-bottom: 6px;
  display: inline-block;
  max-width: 100%;
}

.exit-desc {
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--muted);
  line-height: 1.3;
  word-break: break-word;
}

/* MAIN PANEL */
#main {
  flex: 1;
  background:
    radial-gradient(circle at 80% 20%, rgba(232,198,106,0.07) 0%, rgba(0,0,0,0) 70%),
    radial-gradient(circle at 10% 90%, rgba(104,25,25,0.22) 0%, rgba(0,0,0,0) 70%),
    #0a0705;
  position: relative;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  scrollbar-color: var(--accent) #000;
}
#main::-webkit-scrollbar {
  width: 8px;
}
#main::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
  box-shadow: 0 0 10px rgba(232,198,106,0.7);
}

.main-inner {
  max-width: 900px;
  padding: 24px clamp(16px,2vw,24px) 120px;
  margin: 0 auto;
  position: relative;
  color: var(--text);
}

/* HEADER CARD */
#exitHeader {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius-lg);
  box-shadow:
    0 30px 60px rgba(0,0,0,0.95),
    0 0 60px rgba(232,198,106,0.25),
    0 0 120px rgba(104,25,25,0.4);
  position: relative;
  padding: 20px 20px 16px;
}

.exit-title-row {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  justify-content: space-between;
  gap: 12px;
}

#exitName {
  font-family: var(--font-head);
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  color: var(--text);
  text-shadow:
    0 0 10px rgba(232,198,106,0.6),
    0 0 30px rgba(104,25,25,0.7);
  margin: 0;
  line-height: 1.2;
}

#exitTagline {
  font-size: 0.7rem;
  color: #000;
  background: var(--accent);
  padding: 4px 8px;
  border: 1px solid var(--accent);
  border-radius: var(--radius-sm);
  line-height: 1.3;
  font-weight: 600;
  text-shadow: none;
  box-shadow:
    0 0 20px rgba(232,198,106,0.5),
    0 0 40px rgba(104,25,25,0.6);
  white-space: nowrap;
  max-width: 100%;
}

#exitAngle {
  font-size: 0.7rem;
  color: var(--muted);
  font-style: italic;
  line-height: 1.4;
}

#exitProfile {
  margin-top: 16px;
  font-size: 0.8rem;
  color: var(--text);
  line-height: 1.5;
}

/* ACCORDION SECTIONS */
.section-card {
  margin-top: 20px;
  background: var(--panel-light);
  border: 1px solid var(--line);
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow:
    0 20px 40px rgba(0,0,0,0.9),
    0 0 40px rgba(104,25,25,0.3);
}

.section-header {
  width: 100%;
  background: linear-gradient(to right, rgba(232,198,106,0.12) 0%, rgba(0,0,0,0) 80%);
  color: var(--text);
  border: 0;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  font-family: var(--font-head);
  font-weight: 600;
  font-size: 0.8rem;
  text-align: left;
  line-height: 1.4;
  letter-spacing: 0.06em;
  padding: 14px 16px;
  position: relative;
  cursor: pointer;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  text-shadow:
    0 0 8px rgba(232,198,106,0.5),
    0 0 20px rgba(104,25,25,0.6);
}
.section-header .label {
  display: flex;
  flex-direction: column;
  gap: 3px;
}
.section-header .title-line {
  display: flex;
  align-items: baseline;
  gap: 8px;
}
.section-header .section-title {
  color: var(--text);
}
.section-header .hint {
  color: var(--muted);
  font-family: var(--font-body);
  font-size: 0.6rem;
  font-weight: 400;
  text-shadow: none;
}
.section-header .chevron {
  font-size: 0.8rem;
  line-height: 1;
  color: var(--accent);
  text-shadow: 0 0 10px rgba(232,198,106,0.6), 0 0 20px rgba(104,25,25,0.6);
  transition: transform 0.15s;
}
.section-card.open .section-header .chevron {
  transform: rotate(90deg);
}

.section-body {
  display: none;
  padding: 16px;
  font-size: 0.8rem;
  color: var(--text);
  line-height: 1.5;
}
.section-card.open .section-body {
  display: block;
  background:
    radial-gradient(circle at 10% 0%, rgba(232,198,106,0.07) 0%, transparent 70%),
    radial-gradient(circle at 100% 0%, rgba(104,25,25,0.25) 0%, transparent 70%);
}
.section-body ul {
  margin: 0;
  padding-left: 18px;
}
.section-body li {
  margin-bottom: 10px;
  color: var(--text);
}
.section-body li strong {
  color: var(--accent);
  font-weight: 600;
  text-shadow:
    0 0 12px rgba(232,198,106,0.5),
    0 0 22px rgba(104,25,25,0.6);
}

/* FOOTER NOTE */
.footer-note {
  margin-top: 32px;
  font-size: 0.65rem;
  line-height: 1.4;
  color: var(--muted);
  text-align: center;
  padding-bottom: 60px;
  max-width: 640px;
  margin-left: auto;
  margin-right: auto;
  border-top: 1px solid rgba(255,255,255,0.05);
  padding-top: 20px;
  font-style: italic;
}

/* RESPONSIVE */
@media (max-width: 750px) {
  #sidebar {
    width: 220px;
  }
  #exitName {
    font-size: 1.1rem;
  }
  #exitTagline {
    font-size: 0.7rem;
  }
}
@media (max-width: 600px) {
  body {
    flex-direction: column;
  }
  #sidebar {
    width: 100%;
    max-height: 40vh;
    border-right: 0;
    border-bottom: 1px solid var(--line);
  }
  #main {
    flex: 1;
  }
  .exit-list {
    max-height: calc(40vh - 130px);
  }
  .exit-title-row {
    flex-direction: column;
    align-items: flex-start;
  }
  #exitTagline {
    white-space: normal;
  }
}
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="top-nav">
  <div class="nav-inner">
    <div class="nav-brand">CULT MANUAL</div>
    <div class="nav-links">
      <a class="nav-link" href="index.html">Overview / Indoctrination</a>
      <a class="nav-link" href="recruitment.html">Recruitment</a>
      <a class="nav-link" href="doctrine.html">Doctrine / Purity</a>
      <a class="nav-link" href="enforcement.html">Enforcement</a>
      <a class="nav-link active" href="exit.html">Exit Cost</a>
    </div>
  </div>
</nav>

<!-- SIDEBAR -->
<aside id="sidebar">
  <div class="sidebar-header">
    <div class="app-title">
      <div class="app-mainline">
        <span>EXIT COST</span>
        <span class="section-subtitle">LEAVING / WITHDRAWAL / REBUILD</span>
      </div>
      <div class="section-subtitle" style="color:var(--muted);text-shadow:none;">
        You don’t just walk. You detox.
      </div>
    </div>

    <div class="app-sub">
      They said you’d die if you left. You didn’t. So why does it still feel like dying?
    </div>

    <div class="search-wrap">
      <span class="search-icon">🔍</span>
      <input id="searchInput" type="text" placeholder="Search exit phases..." />
    </div>
  </div>

  <div id="exitList" class="exit-list">
    <!-- JS fills -->
  </div>
</aside>

<!-- MAIN -->
<main id="main">
  <div class="main-inner">
    <section id="exitHeader">
      <div class="exit-title-row">
        <h1 id="exitName">Loading...</h1>
        <div id="exitTagline"></div>
      </div>
      <div id="exitAngle"></div>
      <div id="exitProfile"></div>
    </section>

    <div id="exitSections">
      <!-- JS accordion sections -->
    </div>

    <div class="footer-note">
      You’re allowed to live. You’re allowed to rebuild. You’re allowed to not make them the center of your story anymore.
    </div>
  </div>
</main>

<script>
/*
Exit Object Model:
{
  id: 'acute-detox',
  name: 'Acute Psychological Detox',
  tagline: '“If you leave you’ll die without us” (you left, you didn’t die)',
  angle: 'Leaving feels like ripping a feeding tube out of your own neck.',
  shortDesc: 'First hours / days out.',
  profile: 'Long text...',
  whatYouFeel: [...],
  whyItHurts: [...],
  whatTheyDoNow: [...],
  dangerSpots: [...],
  stabilizeMoves: [...],
  longTermTruth: [...]
}
*/

let openCards = [];
let currentExitId = null;

const exits = [
  {
    id: 'acute-detox',
    name: 'Acute Psychological Detox',
    tagline: '“If you leave you’ll die without us” (you left, you didn’t die)',
    angle: 'The first crash after escape isn’t peace. It’s withdrawal.',
    shortDesc:
      'First hours/days out. You’re shaking, paranoid, guilty, and convinced you ruined everything.',
    profile:
      'When you first break contact, you expect relief. Instead you usually feel terror. That’s on purpose. Cult conditioning links safety to obedience. So the second you’re out of range, your body is convinced you’re in mortal danger. You may sob uncontrollably, shake, feel like puking, feel sure you’re damned, replay phrases the leader said, or hear their voice in your head like they’re still narrating you. That does not mean you made the wrong call. That means the cage worked.',
    whatYouFeel: [
      'Racing thoughts: “Go back and apologize now or they’ll hurt everyone.”',
      'Paranoia that they’re already hunting you.',
      'Guilt so loud you can’t eat or sleep.',
      'Physical shakes like drug withdrawal.',
      'Craving: “If I just text them once, the anxiety will stop.”'
    ],
    whyItHurts: [
      'They trained you to believe safety = them, uncertainty = death.',
      'They cut you off from normal support, so there’s no instant “home base” to run to.',
      'You might have left with nothing (no money, no meds, no phone access).',
      'Your nervous system is like: “We lost the voice that told us what to do. We’re gonna die.”'
    ],
    whatTheyDoNow: [
      'Blow up your phone with “loving” messages: “We just want you safe, come home.”',
      'Threaten you: “If you tell lies about us we’ll expose you.”',
      'Guilt-bomb: “You broke your vow. Souls are on your hands.”',
      'Send someone you loved inside (partner, “best friend,” “mentor”) to cry and beg you back.'
    ],
    dangerSpots: [
      'Answering calls out of panic. Once they’re speaking in your ear, your odds of going back spike hard.',
      'Going back “just to talk it out like adults.” That’s the trap room.',
      'Suicidal thinking — not because you “hate life,” but because you feel like you detonated your only purpose.',
      'Collapsing and accepting whatever terms they give to “take you back,” even worse than before.'
    ],
    stabilizeMoves: [
      'Eat something. Drink water. Warm shower. Sleep. This is medical. Your brain needs fuel to think.',
      'Tell one safe human, “I just left a controlling group. I am not okay, but I am safer than I feel.”',
      'Block their numbers for 24 hours minimum. Yes, block. You can always unblock later if you WANT to, not because you’re shaking.',
      'Write down, in plain ugly language, why you left. Read it back when guilt spikes.'
    ],
    longTermTruth: [
      'The panic fades. It always fades.',
      'Them saying “you’ll die without us” was a control technique, not prophecy.',
      'Shame will try to rewrite history. Keep receipts: dates, abuse, threats.',
      'You are allowed to exist without being supervised.'
    ]
  },

  {
    id: 'identity-crash',
    name: 'Identity Crash',
    tagline: '“Who am I without them?”',
    angle: 'They didn’t just take your time. They took your “I am.”',
    shortDesc:
      'Weeks/months out. You’re technically free, but mentally you’re rubble.',
    profile:
      'You built your entire life around their language, their mission, their approval, their enemies, their version of good and evil. Now that compass is gone. You don’t know who you are politically, spiritually, sexually, morally, socially. You don’t even know what music you actually like. That vacant feeling isn’t proof that you don’t exist — it’s proof that they colonized your identity so completely that now you’re standing in an empty room they used to own.',
    whatYouFeel: [
      'Emptiness that feels like grief.',
      'Embarrassment: “How did I fall for that? Am I stupid?”',
      'Anger at yourself for recruiting others.',
      'Loneliness so intense you almost miss the abusers.',
      'Hypervigilance whenever people act confident.'
    ],
    whyItHurts: [
      'They trained you to believe you were “special” only inside their system.',
      'Any interest or hobby you had pre-cult was labeled sinful/low vibe/ego, so you dropped it.',
      'They discouraged “outside” friendships, so you’re socially starting from zero.',
      'You might have broken bonds (family, partner, kids) while inside, and now you feel unworthy to even try to repair.'
    ],
    whatTheyDoNow: [
      'They’ll say you “lost your way,” “fell back into darkness,” “chose the world.”',
      'They’ll post, message, or leak carefully framed half-truths to make you look unstable.',
      'Some will love-bomb you again around holidays / birthdays when they know you’re weakest.',
      'If they’re extreme: they may stalk you, show up “by coincidence,” or send someone to “check your energy.”'
    ],
    dangerSpots: [
      'Thinking loneliness means you made the wrong decision.',
      'Believing you deserve nothing because you “betrayed the mission.”',
      'Letting them rewrite your exit story until YOU start repeating their PR line.',
      'Self-isolating because you don’t want to “infect anyone with drama.”'
    ],
    stabilizeMoves: [
      'Eat with a normal human in a normal public place. Quiet diner, fast food booth, park bench. Let your body relearn ordinary.',
      'Say one sentence out loud that is yours, not theirs. Example: “I like horror movies,” or “I want to sleep in,” or “I don’t believe they were chosen.”',
      'Reclaim one harmless pre-cult habit (music, game, dumb TV, hobby) without apologizing to imaginary judges.',
      'Repeat: “Missing them does not mean they were good.” Trauma bonds ache when cut.'
    ],
    longTermTruth: [
      'Identity regrows in boring layers, not in one lightning bolt.',
      'The first version of “new you” might just be “not-them.” That’s okay as a bridge.',
      'You’re allowed to be angry at what they took. Anger is part of healing, not proof that you’re “toxic.”',
      'You are not obligated to forgive anybody on their timeline.'
    ]
  },

  {
    id: 'rebuild-life',
    name: 'Rebuilding A Life',
    tagline: 'Housing / money / legal / health / trust',
    angle: 'Freedom without stability still feels like prison.',
    shortDesc:
      'Months and beyond. Practical cleanup. Boring survival work that feels impossible.',
    profile:
      'After you leave the psychological battlefield, you hit logistics. You may have no housing, no job, no ID (they “kept it safe”), no savings, no meds, no transportation, a record in their words that says you’re “dangerous,” and maybe a group of ex-“family” actively smearing you. This part doesn’t feel cinematic. It feels humiliating. But this is where real freedom happens: piece by piece, need by need.',
    whatYouFeel: [
      'Overwhelmed by basic tasks (“how do I even apartment?”).',
      'Ashamed asking for help because you were trained to believe outsiders are dirty.',
      'Paranoid filling out forms because you expect punishment.',
      'Panicked that you’re “too broken to function in normal life.”'
    ],
    whyItHurts: [
      'They may have deliberately sabotaged your credit, your work history, your outside relationships, and your paperwork so you’d be dependent forever.',
      'They may threaten legal action or custody battles.',
      'Your body might be wrecked from sleep deprivation, bad nutrition, forced labor, or assault.',
      'You may be detoxing from control AND from substances if they used drugs to manage people.'
    ],
    whatTheyDoNow: [
      'Harassment campaigns: calling employers, landlords, partners to “warn them about you.”',
      'Attempted contact framed as compassion (“We heard you’re struggling. You know we’d take you back…”).',
      'Love-bomb reunions where they act like the abuse never happened.',
      'Accusing you publicly of abuse THEY did, to flip the script legally/socially.'
    ],
    dangerSpots: [
      'Letting shame keep you homeless instead of asking for resources.',
      'Going back just because you’re hungry.',
      'Believing “I can’t make it alone, I belong to them.” That line was installed.',
      'Trying to heal while still letting them contact you daily.'
    ],
    stabilizeMoves: [
      'Documents first. Get ID, birth certificate, SSN/passport equivalent, medical records. Without ID, you’re stuck. Protect copies.',
      'Money next. Any job. Pride is a luxury; survival buys options.',
      'Healthcare: tell urgent care/clinic “I’m leaving a controlling group and I haven’t slept or eaten right.” People actually take that seriously sometimes.',
      'Contact neutral help: shelters, DV hotlines, survivor networks, ex-members support forums. You’re not the first escapee they’ve met.'
    ],
    longTermTruth: [
      'Rebuilding is slow and unglamorous and that is normal.',
      'You are not “dramatic” for needing 6+ months to feel baseline safe.',
      '“Functioning” again doesn’t mean it didn’t happen. It means it lost.',
      'You do not owe them silence. You owe yourself air.'
    ]
  }

]; // end exits[]


/* DOM REFS */
const exitListEl = document.getElementById('exitList');
const searchInputEl = document.getElementById('searchInput');

const exitNameEl = document.getElementById('exitName');
const exitTaglineEl = document.getElementById('exitTagline');
const exitAngleEl = document.getElementById('exitAngle');
const exitProfileEl = document.getElementById('exitProfile');
const exitSectionsEl = document.getElementById('exitSections');

/* ACCORDION TRACKING */
function registerOpen(card) {
  if (!openCards.includes(card)) {
    openCards.push(card);
  }
  if (openCards.length > 2) {
    const toClose = openCards.shift();
    if (toClose && toClose !== card) {
      toClose.classList.remove('open');
    }
  }
}
function unregister(card) {
  openCards = openCards.filter(c => c !== card);
}

/* BUILD SECTION CARD */
function buildSectionCard(title, hint, bullets, open=false) {
  const card = document.createElement('div');
  card.className = 'section-card' + (open ? ' open' : '');

  const headerBtn = document.createElement('button');
  headerBtn.className = 'section-header';

  const labelWrap = document.createElement('div');
  labelWrap.className = 'label';

  const titleLine = document.createElement('div');
  titleLine.className = 'title-line';

  const titleSpan = document.createElement('div');
  titleSpan.className = 'section-title';
  titleSpan.textContent = title;

  const hintSpan = document.createElement('div');
  hintSpan.className = 'hint';
  hintSpan.textContent = hint;

  titleLine.appendChild(titleSpan);
  labelWrap.appendChild(titleLine);
  labelWrap.appendChild(hintSpan);

  const chev = document.createElement('div');
  chev.className = 'chevron';
  chev.textContent = '▶';

  headerBtn.appendChild(labelWrap);
  headerBtn.appendChild(chev);

  const bodyDiv = document.createElement('div');
  bodyDiv.className = 'section-body';

  const ul = document.createElement('ul');
  bullets.forEach(b => {
    const li = document.createElement('li');
    li.innerHTML = b.replace(/^([^:]+):/, '<strong>$1:</strong>');
    ul.appendChild(li);
  });
  bodyDiv.appendChild(ul);

  headerBtn.addEventListener('click', () => {
    const isOpen = card.classList.contains('open');

    if (isOpen) {
      card.classList.remove('open');
      unregister(card);
    } else {
      card.classList.add('open');
      registerOpen(card);
    }
  });

  card.appendChild(headerBtn);
  card.appendChild(bodyDiv);

  if (open) {
    registerOpen(card);
  }

  return card;
}

/* RENDER SIDEBAR LIST */
function renderExitList(filterText = '') {
  const f = filterText.trim().toLowerCase();
  exitListEl.innerHTML = '';

  exits
    .filter(x => {
      if (!f) return true;
      const haystack = [
        x.name,
        x.shortDesc,
        x.tagline,
        x.angle
      ].join(' ').toLowerCase();
      return haystack.includes(f);
    })
    .forEach(x => {
      const item = document.createElement('div');
      item.className = 'exit-item';
      item.setAttribute('data-id', x.id);

      const line1 = document.createElement('div');
      line1.className = 'exit-line1';

      const nameSpan = document.createElement('div');
      nameSpan.className = 'exit-name';
      nameSpan.textContent = x.name;

      const tagSpan = document.createElement('div');
      tagSpan.className = 'exit-tag';
      tagSpan.textContent = x.tagline;

      line1.appendChild(nameSpan);
      line1.appendChild(tagSpan);

      const descDiv = document.createElement('div');
      descDiv.className = 'exit-desc';
      descDiv.textContent = x.shortDesc;

      item.appendChild(line1);
      item.appendChild(descDiv);

      item.addEventListener('click', () => {
        showExit(x.id);
      });

      exitListEl.appendChild(item);
    });

  highlightActive(currentExitId);
}

/* SHOW SELECTED EXIT IN MAIN PANEL */
function showExit(id) {
  const x = exits.find(e => e.id === id);
  if (!x) return;

  currentExitId = id;

  exitNameEl.textContent = x.name;
  exitTaglineEl.textContent = x.tagline;
  exitAngleEl.textContent = x.angle;
  exitProfileEl.textContent = x.profile;

  exitSectionsEl.innerHTML = '';
  openCards = [];

  const sectionsData = [
    { title: 'What You Feel',        hint: 'Body + mind reaction after leaving',           arr: x.whatYouFeel || [] },
    { title: 'Why It Hurts',         hint: 'The engineered part, not “your weakness”',     arr: x.whyItHurts || [] },
    { title: 'What They Do Now',     hint: 'Post-exit pressure, bait, threats',            arr: x.whatTheyDoNow || [] },
    { title: 'Danger Spots',         hint: 'Where people get pulled back or break down',   arr: x.dangerSpots || [] },
    { title: 'Stabilize Moves',      hint: 'Immediate survival steps for your nervous system', arr: x.stabilizeMoves || [] },
    { title: 'Long-Term Truth',      hint: 'Things you only believe after some distance',  arr: x.longTermTruth || [] },
  ];

  sectionsData.forEach((block, idx) => {
    if (!block.arr || block.arr.length === 0) return;
    const card = buildSectionCard(
      block.title,
      block.hint,
      block.arr,
      (idx === 0 || idx === 1)
    );
    exitSectionsEl.appendChild(card);
  });

  highlightActive(id);

  document.getElementById('main').scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

/* HIGHLIGHT ACTIVE IN SIDEBAR */
function highlightActive(id) {
  const items = exitListEl.querySelectorAll('.exit-item');
  items.forEach(el => {
    if (el.getAttribute('data-id') === id) {
      el.classList.add('active');
    } else {
      el.classList.remove('active');
    }
  });
}

/* SEARCH HOOK */
searchInputEl.addEventListener('input', (e) => {
  renderExitList(e.target.value);
});

/* INIT */
renderExitList('');
if (exits.length > 0) {
  showExit(exits[0].id);
}
</script>

</body>
</html>
