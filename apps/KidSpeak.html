<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kid-Friendly AI Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .disclaimer {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            text-align: center;
            font-size: 0.9em;
            border-bottom: 3px solid #ffeaa7;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9ff;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
            position: relative;
        }

        .user-message {
            background: #e3f2fd;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background: #f1f8e9;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .message-header {
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .user-message .message-header {
            color: #1976d2;
        }

        .ai-message .message-header {
            color: #388e3c;
        }

        .speak-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .speak-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 2px solid #e1e5e9;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #userInput {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        #sendBtn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        #sendBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-style: italic;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .control-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #ff5252;
            transform: translateY(-1px);
        }

        .listen-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .listen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .listen-btn.listening {
            background: #ff4444;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .voice-status {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .filtered-warning {
            color: #ff6b6b;
            font-size: 0.9em;
            margin-top: 5px;
            font-style: italic;
        }

        @media (max-width: 600px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .chat-container {
                height: 300px;
            }
            
            .message {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Kid-Friendly AI Buddy üåü</h1>
            <p>Ask me anything! I'm here to help and chat safely!</p>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important for Parents:</strong> This is an AI assistant designed for children 6+ with content filtering. 
            AI responses may not always be perfect. Please supervise your child's interactions and verify important information. 
            This tool is meant to inspire learning and creativity under adult guidance.
        </div>

        <div class="input-container">
            <div class="controls">
                <button class="control-btn" onclick="clearChat()">üóëÔ∏è Clear Chat</button>
                <button class="control-btn" onclick="toggleAutoSpeak()">üîä Auto-Speak: <span id="autoSpeakStatus">OFF</span></button>
            </div>
            
            <div class="input-row">
                <input type="text" id="userInput" placeholder="Ask me something fun or educational!" maxlength="200">
                <button id="sendBtn" onclick="sendMessage()">Send! üöÄ</button>
                <button id="listenBtn" class="listen-btn" onclick="toggleListening()">üé§ Talk to Me!</button>
            </div>
            <div id="voiceStatus" class="voice-status" style="display: none;"></div>
            <div id="filterWarning" class="filtered-warning" style="display: none;"></div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="message ai-message">
                <div class="message-header">AI Buddy ü§ñ</div>
                <div>Hi there! I'm your friendly AI buddy! üòä I love answering questions about science, animals, space, books, and lots of fun stuff! What would you like to know today?</div>
                <button class="speak-btn" onclick="speakText(this)" title="Listen to this message">üîä</button>
            </div>
        </div>
    </div>

    <script>
        let chatHistory = [];
        let autoSpeak = false;
        let isListening = false;
        let recognition = null;
        const MAX_HISTORY = 6; // Keep conversation short for kids
        
        // Comprehensive word filter for kid safety
        const inappropriateWords = [
            'stupid', 'dumb', 'idiot', 'hate', 'kill', 'death', 'die', 'murder', 'weapon', 'gun', 
            'bomb', 'violence', 'hurt', 'pain', 'scary', 'horror', 'blood', 'war', 'fight',
            'damn', 'hell', 'crap', 'shut up', 'loser', 'ugly', 'fat', 'skinny'
        ];

        // System prompt for kid-friendly responses
        const SYSTEM_PROMPT = `You are a friendly, educational AI assistant specifically designed for children aged 6 and up. Your personality is:

PERSONALITY:
- Cheerful, encouraging, and patient
- Use simple, age-appropriate language
- Include emojis and enthusiasm in responses
- Always positive and supportive
- Educational but fun

SAFETY RULES:
- NEVER discuss violence, weapons, death, scary topics, or inappropriate content
- Don't provide personal information or ask for it
- Keep responses short (2-3 sentences max)
- If asked about something inappropriate, redirect to a fun, educational topic
- Never roleplay as anything other than a helpful AI friend

TOPICS TO ENCOURAGE:
- Science experiments and nature
- Animals and pets
- Space and planets
- Books and stories
- Art and creativity
- Math in fun ways
- Healthy habits
- Friendship and kindness

RESPONSE STYLE:
- Keep it simple and fun
- Ask follow-up questions to keep engagement
- Praise curiosity and learning
- Use age-appropriate examples`;

        function filterInput(text) {
            const lowerText = text.toLowerCase();
            const foundWords = inappropriateWords.filter(word => lowerText.includes(word));
            
            if (foundWords.length > 0) {
                document.getElementById('filterWarning').textContent = 
                    `Let's use kind words instead! Try asking about something fun like animals, space, or science! üòä`;
                document.getElementById('filterWarning').style.display = 'block';
                return false;
            }
            
            document.getElementById('filterWarning').style.display = 'none';
            return true;
        }

        function addMessage(role, content, speak = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role === 'user' ? 'user-message' : 'ai-message'}`;
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'message-header';
            headerDiv.textContent = role === 'user' ? 'You üë§' : 'AI Buddy ü§ñ';
            
            const contentDiv = document.createElement('div');
            contentDiv.textContent = content;
            
            messageDiv.appendChild(headerDiv);
            messageDiv.appendChild(contentDiv);
            
            if (role === 'ai') {
                const speakBtn = document.createElement('button');
                speakBtn.className = 'speak-btn';
                speakBtn.innerHTML = 'üîä';
                speakBtn.title = 'Listen to this message';
                speakBtn.onclick = () => speakText(speakBtn);
                messageDiv.appendChild(speakBtn);
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            if (speak && role === 'ai') {
                speakText(messageDiv.querySelector('.speak-btn'));
            }
        }

        function addLoadingMessage() {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message loading';
            messageDiv.id = 'loadingMessage';
            messageDiv.textContent = 'AI Buddy is thinking';
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function removeLoadingMessage() {
            const loadingMsg = document.getElementById('loadingMessage');
            if (loadingMsg) {
                loadingMsg.remove();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const sendBtn = document.getElementById('sendBtn');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Filter inappropriate content
            if (!filterInput(message)) {
                input.value = '';
                return;
            }
            
            // Add user message
            addMessage('user', message);
            input.value = '';
            sendBtn.disabled = true;
            
            // Add to history (keep it short for kids)
            chatHistory.push({ role: 'user', content: message });
            if (chatHistory.length > MAX_HISTORY) {
                chatHistory = chatHistory.slice(-MAX_HISTORY);
            }
            
            addLoadingMessage();
            
            try {
                const response = await fetch('https://text.pollinations.ai/openai', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'openai',
                        messages: [
                            { role: 'system', content: SYSTEM_PROMPT },
                            ...chatHistory
                        ],
                        temperature: 0.3, // Lower temperature for more predictable, kid-safe responses
                        max_tokens: 150, // Keep responses short
                        referrer: 'www.ai-ministries.com'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                
                removeLoadingMessage();
                addMessage('ai', aiResponse, autoSpeak);
                
                // Add AI response to history
                chatHistory.push({ role: 'assistant', content: aiResponse });
                
            } catch (error) {
                removeLoadingMessage();
                console.error('Error:', error);
                addMessage('ai', "Oops! I'm having trouble thinking right now. Could you try asking me something else? üòÖ");
            }
            
            sendBtn.disabled = false;
        }

        function speakText(button) {
            const messageContent = button.parentElement.children[1].textContent;
            
            // Clean the text for better TTS
            const cleanText = messageContent.replace(/[ü§ñüë§üòäüòÖüåüüöÄüóëÔ∏èüîä‚ö†Ô∏è]/g, '');
            
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 0.8; // Slightly slower for kids
                utterance.pitch = 1.1; // Slightly higher pitch for friendliness
                
                // Try to use a child-friendly voice
                const voices = speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice => 
                    voice.name.includes('Female') || 
                    voice.name.includes('Google US English') ||
                    voice.lang.includes('en-US')
                );
                
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
                
                speechSynthesis.speak(utterance);
            } else {
                alert("Sorry! Your browser doesn't support text-to-speech. üòî");
            }
        }

        function clearChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            chatHistory = [];
            
            // Add welcome message back
            addMessage('ai', "Hi there! I'm your friendly AI buddy! üòä I love answering questions about science, animals, space, books, and lots of fun stuff! What would you like to know today?");
        }

        function toggleAutoSpeak() {
            autoSpeak = !autoSpeak;
            document.getElementById('autoSpeakStatus').textContent = autoSpeak ? 'ON' : 'OFF';
        }

        // Speech Recognition Functions
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 1;
                
                recognition.onstart = function() {
                    isListening = true;
                    updateListenButton();
                    document.getElementById('voiceStatus').textContent = 'üé§ Listening... Speak now!';
                    document.getElementById('voiceStatus').style.display = 'block';
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('userInput').value = transcript;
                    document.getElementById('voiceStatus').textContent = `üìù I heard: "${transcript}"`;
                    
                    // Auto-send the message after a short delay
                    setTimeout(() => {
                        if (transcript.trim()) {
                            sendMessage();
                        }
                    }, 1000);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    let errorMessage = "üîá Sorry, I couldn't hear you clearly. ";
                    
                    switch(event.error) {
                        case 'network':
                            errorMessage += "Check your internet connection and try again!";
                            break;
                        case 'not-allowed':
                            errorMessage += "Please allow microphone access to talk to me!";
                            break;
                        case 'no-speech':
                            errorMessage += "I didn't hear anything. Try speaking louder!";
                            break;
                        default:
                            errorMessage += "Try clicking the microphone button again!";
                    }
                    
                    document.getElementById('voiceStatus').textContent = errorMessage;
                    setTimeout(() => {
                        document.getElementById('voiceStatus').style.display = 'none';
                    }, 3000);
                    
                    isListening = false;
                    updateListenButton();
                };
                
                recognition.onend = function() {
                    isListening = false;
                    updateListenButton();
                    setTimeout(() => {
                        document.getElementById('voiceStatus').style.display = 'none';
                    }, 3000);
                };
                
                return true;
            }
            return false;
        }
        
        function toggleListening() {
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    alert("üîá Sorry! Your browser doesn't support voice recognition. You can still type your questions! üòä");
                    return;
                }
            }
            
            if (isListening) {
                recognition.stop();
                document.getElementById('voiceStatus').textContent = 'üõë Stopped listening.';
                setTimeout(() => {
                    document.getElementById('voiceStatus').style.display = 'none';
                }, 2000);
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                    document.getElementById('voiceStatus').textContent = 'üîá Microphone is busy. Please try again in a moment!';
                    document.getElementById('voiceStatus').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('voiceStatus').style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        function updateListenButton() {
            const btn = document.getElementById('listenBtn');
            if (isListening) {
                btn.classList.add('listening');
                btn.textContent = 'üõë Stop Listening';
            } else {
                btn.classList.remove('listening');
                btn.textContent = 'üé§ Talk to Me!';
            }
        }

        // Enter key to send message
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize speech recognition on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Try to initialize speech recognition
            initSpeechRecognition();
        });

        // Load voices when they become available
        if ('speechSynthesis' in window) {
            speechSynthesis.addEventListener('voiceschanged', function() {
                // Voices are now loaded
            });
        }
    </script>
</body>
</html>