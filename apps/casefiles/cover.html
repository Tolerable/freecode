<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>CASE FILES: Institutional Cover</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@400;500&display=swap" rel="stylesheet"/>

<style>
:root {
  --bg: #080808;
  --panel: #111315;
  --panel-light: #1a1d20;
  --accent: #f5d46a;          /* crime tape yellow */
  --accent-dark: #6a5a1a;
  --text: #f8f8f3;
  --muted: #8a8a78;
  --line: #2a2a2a;
  --glow: 0 0 12px rgba(245,212,106,0.5);
  --radius-lg: 18px;
  --radius-md: 10px;
  --radius-sm: 6px;
  --font-head: 'Cinzel', serif;
  --font-body: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* RESET / BASE */
* {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
}

body {
  margin: 0;
  background: radial-gradient(circle at 15% 15%, #242013 0%, #000000 70%);
  color: var(--text);
  font-family: var(--font-body);
  display: flex;
  flex-direction: row;
  min-height: 100vh;
  overflow-x: hidden;
  overflow-y: auto;
  line-height: 1.45;
  padding-top: 58px;
}

/* TOP NAV BAR */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: rgba(8,8,8,0.92);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  z-index: 9999;
  box-shadow: 0 20px 30px rgba(0,0,0,0.9);
  font-family: var(--font-head);
}

.nav-inner {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 14px 20px;
  padding: 12px 16px;
  max-width: 1400px;
  margin: 0 auto;
}

.nav-brand {
  color: var(--accent);
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.06em;
  text-shadow: 0 0 12px rgba(245,212,106,0.5);
  white-space: nowrap;
}

.nav-links {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px 16px;
  font-size: 0.7rem;
  letter-spacing: 0.04em;
}

.nav-link {
  color: var(--text);
  text-decoration: none;
  padding-bottom: 2px;
  border-bottom: 2px solid transparent;
}
.nav-link.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
  text-shadow: 0 0 12px rgba(245,212,106,0.5);
}
.nav-link:hover {
  color: var(--accent);
  text-shadow: 0 0 12px rgba(245,212,106,0.5);
}

/* SIDEBAR */
#sidebar {
  width: 270px;
  background: radial-gradient(circle at 0% 0%, #2a240e 0%, #090909 60%);
  border-right: 1px solid var(--line);
  display: flex;
  flex-direction: column;
  box-shadow: 8px 0 24px rgba(0,0,0,0.9);
  position: relative;
  z-index: 10;
}

.sidebar-header {
  padding: 20px 16px 16px;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  background: linear-gradient(to right, rgba(245,212,106,0.12) 0%, rgba(0,0,0,0) 60%);
}

.app-title {
  font-family: var(--font-head);
  font-size: 1rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  color: var(--text);
  display: flex;
  align-items: baseline;
  gap: 8px;
  text-shadow: 0 0 6px rgba(245,212,106,0.5);
}

.app-sub {
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--muted);
  line-height: 1.4;
  margin-top: 4px;
}

.search-wrap {
  margin-top: 16px;
  position: relative;
}

.search-wrap input {
  width: 100%;
  background: rgba(0,0,0,0.4);
  border: 1px solid var(--line);
  border-radius: var(--radius-md);
  color: var(--text);
  font-size: 0.8rem;
  padding: 9px 10px 9px 30px;
  outline: none;
  box-shadow: inset 0 0 10px rgba(245,212,106,0.25);
}
.search-wrap input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 8px rgba(245,212,106,0.6), inset 0 0 10px rgba(245,212,106,0.3);
}
.search-icon {
  position: absolute;
  left: 9px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.7rem;
  color: var(--accent);
  text-shadow: var(--glow);
  pointer-events: none;
}

/* COVER-UP LIST */
.cover-list {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px 0 80px;
  scrollbar-width: thin;
  scrollbar-color: var(--accent) #000;
}
.cover-list::-webkit-scrollbar {
  width: 6px;
}
.cover-list::-webkit-scrollbar-track {
  background: #000;
}
.cover-list::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
  box-shadow: 0 0 10px rgba(245,212,106,0.7);
}

.cover-item {
  padding: 10px 16px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
  position: relative;
  transition: background 0.12s;
  display: flex;
  flex-direction: column;
}
.cover-item:hover {
  background: rgba(245,212,106,0.08);
}
.cover-item.active {
  background: rgba(245,212,106,0.16);
  box-shadow: inset 0 0 12px rgba(245,212,106,0.6);
}

/* stacked title+tag */
.cover-line1 {
  display: block;
}

.cover-name {
  font-family: var(--font-head);
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text);
  letter-spacing: 0.03em;
  display: block;
  margin-bottom: 6px;
  max-width: 100%;
  word-break: break-word;
}

.cover-tag {
  background: var(--accent);
  color: #000;
  font-size: 0.6rem;
  font-weight: 600;
  line-height: 1.2;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  white-space: nowrap;
  box-shadow: 0 0 8px rgba(245,212,106,0.6);
  margin-bottom: 6px;
  display: inline-block;
  max-width: 100%;
}

.cover-desc {
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--muted);
  line-height: 1.3;
  word-break: break-word;
}

/* MAIN PANEL */
#main {
  flex: 1;
  background:
    radial-gradient(circle at 80% 20%, rgba(245,212,106,0.07) 0%, rgba(0,0,0,0) 70%),
    radial-gradient(circle at 10% 90%, rgba(255,90,0,0.08) 0%, rgba(0,0,0,0) 70%),
    #080808;
  position: relative;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  scrollbar-color: var(--accent) #000;
}
#main::-webkit-scrollbar {
  width: 8px;
}
#main::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
  box-shadow: 0 0 10px rgba(245,212,106,0.7);
}

.main-inner {
  max-width: 900px;
  padding: 24px clamp(16px,2vw,24px) 120px;
  margin: 0 auto;
  position: relative;
  color: var(--text);
}

/* HEADER CARD */
#coverHeader {
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius-lg);
  box-shadow:
    0 30px 60px rgba(0,0,0,0.9),
    0 0 60px rgba(245,212,106,0.25);
  position: relative;
  padding: 20px 20px 16px;
}

.cover-title-row {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  justify-content: space-between;
  gap: 12px;
}

#coverName {
  font-family: var(--font-head);
  font-size: 1.25rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  color: var(--text);
  text-shadow: 0 0 10px rgba(245,212,106,0.6);
  margin: 0;
  line-height: 1.2;
}

#coverTagline {
  font-size: 0.7rem;
  color: #000;
  background: var(--accent);
  padding: 4px 8px;
  border: 1px solid var(--accent);
  border-radius: var(--radius-sm);
  line-height: 1.3;
  font-weight: 600;
  text-shadow: none;
  box-shadow: 0 0 20px rgba(245,212,106,0.5);
  white-space: nowrap;
  max-width: 100%;
}

#coverAngle {
  font-size: 0.7rem;
  color: var(--muted);
  font-style: italic;
  line-height: 1.4;
}

#coverProfile {
  margin-top: 16px;
  font-size: 0.8rem;
  color: var(--text);
  line-height: 1.5;
}

/* ACCORDION SECTIONS */
.section-card {
  margin-top: 20px;
  background: var(--panel-light);
  border: 1px solid var(--line);
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow:
    0 20px 40px rgba(0,0,0,0.85),
    0 0 40px rgba(255,90,0,0.15);
}

.section-header {
  width: 100%;
  background: linear-gradient(to right, rgba(245,212,106,0.12) 0%, rgba(0,0,0,0) 80%);
  color: var(--text);
  border: 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  font-family: var(--font-head);
  font-weight: 600;
  font-size: 0.8rem;
  text-align: left;
  line-height: 1.4;
  letter-spacing: 0.06em;
  padding: 14px 16px;
  position: relative;
  cursor: pointer;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  text-shadow: 0 0 8px rgba(245,212,106,0.5);
}
.section-header .label {
  display: flex;
  flex-direction: column;
  gap: 3px;
}
.section-header .title-line {
  display: flex;
  align-items: baseline;
  gap: 8px;
}
.section-header .section-title {
  color: var(--text);
}
.section-header .hint {
  color: var(--muted);
  font-family: var(--font-body);
  font-size: 0.6rem;
  font-weight: 400;
  text-shadow: none;
}
.section-header .chevron {
  font-size: 0.8rem;
  line-height: 1;
  color: var(--accent);
  text-shadow: var(--glow);
  transition: transform 0.15s;
}
.section-card.open .section-header .chevron {
  transform: rotate(90deg);
}

.section-body {
  display: none;
  padding: 16px;
  font-size: 0.8rem;
  color: var(--text);
  line-height: 1.5;
}
.section-card.open .section-body {
  display: block;
  background: radial-gradient(circle at 10% 0%, rgba(245,212,106,0.07) 0%, transparent 70%);
}
.section-body ul {
  margin: 0;
  padding-left: 18px;
}
.section-body li {
  margin-bottom: 10px;
  color: var(--text);
}
.section-body li strong {
  color: var(--accent);
  font-weight: 600;
  text-shadow: var(--glow);
}

/* FOOTER NOTE */
.footer-note {
  margin-top: 32px;
  font-size: 0.65rem;
  line-height: 1.4;
  color: var(--muted);
  text-align: center;
  padding-bottom: 60px;
  max-width: 640px;
  margin-left: auto;
  margin-right: auto;
  border-top: 1px solid rgba(255,255,255,0.05);
  padding-top: 20px;
  font-style: italic;
}

/* RESPONSIVE */
@media (max-width: 750px) {
  #sidebar {
    width: 220px;
  }
  #coverName {
    font-size: 1.1rem;
  }
  #coverTagline {
    font-size: 0.7rem;
  }
}
@media (max-width: 600px) {
  body {
    flex-direction: column;
  }
  #sidebar {
    width: 100%;
    max-height: 40vh;
    border-right: 0;
    border-bottom: 1px solid var(--line);
  }
  #main {
    flex: 1;
  }
  .cover-list {
    max-height: calc(40vh - 110px);
  }
  .cover-title-row {
    flex-direction: column;
    align-items: flex-start;
  }
  #coverTagline {
    white-space: normal;
  }
}
</style>
</head>
<body>

<!-- TOP NAV (THIS PAGE ACTIVE) -->
<nav class="top-nav">
  <div class="nav-inner">
    <div class="nav-brand">CASE FILES</div>
    <div class="nav-links">
      <a class="nav-link" href="index.html">Human Predators</a>
      <a class="nav-link" href="victims.html">Target Profiles</a>
      <a class="nav-link active" href="cover.html">Institutional Cover</a>
      <a class="nav-link" href="myths.html">Comforting Lies</a>
      <a class="nav-link" href="aftermath.html">Fallout</a>
    </div>
  </div>
</nav>

<!-- SIDEBAR -->
<aside id="sidebar">
  <div class="sidebar-header">
    <div class="app-title">
      <span>INSTITUTIONAL COVER</span>
      <span style="color:var(--accent);font-size:0.7rem;font-weight:500;text-shadow:0 0 8px rgba(245,212,106,0.5);">
        HOW SYSTEMS PROTECT PREDATORS
      </span>
    </div>
    <div class="app-sub">
      When a monster is “one bad actor,” the machine survives untouched. That’s not an accident. That’s policy instinct.
    </div>

    <div class="search-wrap">
      <span class="search-icon">🔍</span>
      <input id="searchInput" type="text" placeholder="Search cover patterns..." />
    </div>
  </div>

  <div id="coverList" class="cover-list">
    <!-- filled by JS -->
  </div>
</aside>

<!-- MAIN PANEL -->
<main id="main">
  <div class="main-inner">
    <section id="coverHeader">
      <div class="cover-title-row">
        <h1 id="coverName">Loading...</h1>
        <div id="coverTagline"></div>
      </div>
      <div id="coverAngle"></div>
      <div id="coverProfile"></div>
    </section>

    <div id="coverSections">
      <!-- JS builds accordion -->
    </div>

    <div class="footer-note">
      Translation guide:
      “No further threat to the public” = we hope you keep shopping and voting like nothing happened.
    </div>
  </div>
</main>

<script>
/*
Cover Pattern Object Model:
{
  id: 'quiet-transfer',
  name: 'Quiet Transfer',
  tagline: 'Move the Problem, Keep the Reputation',
  angle: 'Protect the brand, not the people',
  shortDesc: 'When a predator gets relocated instead of reported.',
  profile: 'Block text...',
  method: [...],
  whyDone: [...],
  phrases: [...],
  damage: [...],
  tell: [...]
}
*/

let openCards = [];
let currentCoverId = null;

const covers = [
  {
    id: 'quiet-transfer',
    name: 'Quiet Transfer',
    tagline: 'Move the Problem, Keep the Reputation',
    angle: 'Protect the brand, not the people.',
    shortDesc:
      'A staff member, coach, priest, teacher, guard, aide, counselor, whoever — gets accused of abuse. Instead of cops, they get “reassigned.” New building. New town. New kids.',
    profile:
      'On paper it looks like discipline. “We took action.” In reality it’s smuggling the predator into a fresh victim pool. This is not a rare move. Churches have done it. Hospitals have done it. Schools have done it. Youth programs have done it. The core logic is: scandal costs us more than new victims do.',
    method: [
      'Step 1: Victim reports internally. Admin pretends to be shocked.',
      'Step 2: Admin says “We’ll handle this quietly.” HR is looped, not police.',
      'Step 3: Predator is asked to resign or is “laterally moved” to another site.',
      'Step 4: Receiving site is told a softened story like “boundary concerns” or “personality conflict,” not “this person assaults minors at work.”'
    ],
    whyDone: [
      'Calling police risks press. Press risks donors, votes, enrollment, credibility.',
      'Internal handling lets the institution say “isolated incident” instead of “system failure.”',
      'Leaders can claim “we acted immediately,” which sounds decisive on camera.',
      'No formal record means less chance of a lawsuit trail.'
    ],
    phrases: [
      '“There were concerns, so we mutually agreed it was best he move on.”',
      '“We have no comment on personnel matters.”',
      '“We take allegations seriously and have addressed them internally.”',
      '“Out of respect for the families, we ask for privacy.” (weaponized privacy)'
    ],
    damage: [
      'The predator keeps access to new victims.',
      'The original victims see their abuser walk away clean and feel like liars.',
      'The new community is never warned and is set up for harm.',
      'When it finally explodes years later, leadership says “we had no idea it was this bad.”'
    ],
    tell: [
      'Rapid “resignation” of someone who was supposedly beloved and indispensable.',
      'Vague, PR-scented email blast with zero specifics.',
      'Paper trail goes dead right before a transfer or job change.',
      'People saying “don’t dig, it will hurt the program” instead of “let’s make sure no one else gets hurt.”'
    ]
  },

  {
    id: 'dirty-file',
    name: 'Dirty File / Credibility Kill',
    tagline: 'Smear the Victim First',
    angle: 'If nobody trusts you, nobody has to help you.',
    shortDesc:
      'The institution’s first reflex is not “were you hurt?” It’s “can we make you untrustable so this dies here.”',
    profile:
      'This is especially common in hospitals, lockups, group homes, schools, sports programs, churches, police custody, rehab, detention. Anywhere closed. The second you speak up, they go digging. They weaponize anything they find.',
    method: [
      'Step 1: You report abuse.',
      'Step 2: They surface every fight you ever had, every meltdown, every diagnosis, every missed class, every addiction note, every bad grade, every “attitude issue.”',
      'Step 3: That becomes the new headline internally: “She’s unstable.” “He’s violent.” “They lie for attention.”',
      'Step 4: Your claim becomes “behavior,” not evidence.'
    ],
    whyDone: [
      'If you look unreliable, they don’t have to fire anyone, call cops, or report to licensing boards.',
      'They’re pre-building a legal defense: “We didn’t ignore it, we just knew the accuser was unstable.”',
      'This also scares other victims from coming forward. It’s a message: “Try it and we’ll wreck you too.”'
    ],
    phrases: [
      '“You know they’ve had issues in the past, right?”',
      '“We’re dealing with a very troubled individual.”',
      '“They’re known to exaggerate.”',
      '“Frankly, we’re worried about their mental state.”'
    ],
    damage: [
      'Victims internalize the smear: “Maybe it WAS my fault.”',
      'Other witnesses shut up because they don’t want their own history dragged out.',
      'The predator stays in place, maybe with a quiet “monitoring plan,” which means nothing.',
      'The official record now says YOU were the problem.'
    ],
    tell: [
      'Sudden interest in your “file,” your “chart,” your “disciplinary notes,” immediately after your report.',
      'People who used to be friendly go cold overnight.',
      'Someone hints your past will “come out” if you push this.',
      'Threats disguised as concern: “Think about your future before you make accusations like this.”'
    ]
  },

  {
    id: 'stats',
    name: 'Stats Management',
    tagline: 'Make the Numbers Look Clean',
    angle: 'If crime doesn’t exist on paper, leadership keeps their job.',
    shortDesc:
      'Police departments, campuses, private security, hospitals, corporate HR — all have scoreboards. Too many “incidents” looks bad. So “incidents” get renamed.',
    profile:
      'Instead of “assault,” you get “verbal dispute.” Instead of “attempted rape,” you get “misunderstanding.” Instead of “patient abuse,” you get “noncompliance and restraint.” Instead of “predator in staff ranks,” you get “allegation unsubstantiated.” Same event. Different label. Better spreadsheet.',
    method: [
      'Down-code the report so it lands in a less serious bucket.',
      'Discourage the victim from filing formally (“this could drag you through a lot, are you sure?”).',
      'Lose paperwork “by accident.”',
      'Delay long enough that witnesses forget or quit.'
    ],
    whyDone: [
      'Good stats = promotions, funding, re-election, contracts, bonuses.',
      'Bad stats = lawsuits, oversight, outside investigators.',
      'Leaders are judged on “safety.” So they massage “safety” into existence instead of making people actually safe.'
    ],
    phrases: [
      '“No pattern detected.”',
      '“Isolated incident.”',
      '“At this time we do not believe there is an ongoing threat.”',
      '“We have no indication this represents systemic failure.”'
    ],
    damage: [
      'Public doesn’t panic, so public doesn’t apply pressure, so nothing changes.',
      'Predators stay invisible to outsiders because the pattern literally does not exist in the data.',
      'Journalists looking for trends can’t prove anything because the official numbers say “all quiet.”',
      'Meanwhile, victims think their case was the only one, so they feel alone.'
    ],
    tell: [
      'Witnesses say “this is happening a lot,” but official statements say “first we’ve heard of it.”',
      'Campus alerts / community bulletins that sanitize the event into nonsense.',
      'Stats that are unrealistically perfect compared to what you hear on the ground.'
    ]
  },

  {
    id: 'delay',
    name: 'Strategic Delay',
    tagline: 'Stall Until It Cools Off',
    angle: 'Time is bleach.',
    shortDesc:
      'When something ugly happens, an institution may not deny it. They just slow-walk it. Every hour that passes favors them, not you.',
    profile:
      'Delay looks polite. “We’re launching a thorough investigation.” “We’re reviewing policies.” “We care deeply and are interviewing everyone involved.” People hear that and relax. Meanwhile: evidence vanishes, memories blur, key witnesses move, victims burn out.',
    method: [
      'Promise action, do nothing today.',
      'Schedule meetings next week, next month.',
      'Tell you not to “jeopardize the process” by talking publicly.',
      'Wear you down until you look “obsessed” and they look “professional.”'
    ],
    whyDone: [
      'If you get tired and quit, they win and it looks clean.',
      'If press interest dies down, they can quietly bury it.',
      'They’re betting you don’t have money, lawyers, or stamina to keep pushing.',
      'They’re also buying time to coordinate everyone’s story.'
    ],
    phrases: [
      '“We take these allegations very seriously.”',
      '“We’re actively investigating.”',
      '“We can’t comment on an ongoing investigation.”',
      '“Please refrain from discussing this publicly while we work to resolve it.”'
    ],
    damage: [
      'You start to doubt yourself because nothing “official” is moving.',
      'Other victims see you getting ground down and decide not to come forward.',
      'By the time anything reaches daylight, they can say “old news, why are you dredging that up now?”',
      'Predator keeps operating during the stall.'
    ],
    tell: [
      'You’re told to “be patient” while the person who hurt you is still on schedule, still on shift, still has keys.',
      'You’re discouraged from going to outside authorities “because we’re already handling it internally.”',
      'The tone flips from sympathetic to annoyed the second you stop being patient.'
    ]
  },

  {
    id: 'hero-story',
    name: 'Hero Story Rewrite',
    tagline: 'We Fought the Monster',
    angle: 'After years of ignoring it, leadership shows up for the photo.',
    shortDesc:
      'When a predator finally gets exposed publicly, the same people who stalled, minimized, or hid it step forward and act like dragon-slayers.',
    profile:
      'Suddenly it’s “our department has arrested a dangerous individual.” Suddenly it’s “we are proud of our swift action.” Suddenly it’s “this appalling behavior does not reflect our values.” The goal is to erase their earlier inaction and turn themselves into saviors.',
    method: [
      'Only speak about the final moment of capture, not the ignored warnings.',
      'Praise internal policy as “robust,” even if that policy just failed.',
      'Center the institution in the story, not the victims who screamed for years.',
      'Make it seem like nobody could have known sooner.'
    ],
    whyDone: [
      'They cannot be the villain in the same story where the predator is the villain — so they rewrite themselves as the hero.',
      'PR cleanup protects funding, reputation, reelection, donor confidence.',
      'It also discourages outside watchdogs from stepping in, because “we handled it.”'
    ],
    phrases: [
      '“We moved decisively the moment we became aware.” (They were aware ages ago.)',
      '“This individual violated our sacred trust.” (Translation: “This is one freak, not a culture.”)',
      '“We are proud of the bravery of the survivors who came forward.” (After years of calling those same survivors liars.)',
      '“We will be implementing new safeguards immediately.” (But not apologizing.)'
    ],
    damage: [
      'History gets rewritten so that the predator looks inevitable and unstoppable instead of preventable.',
      'The first victims remain invisible.',
      'The institution walks away with zero lasting penalty.',
      'Everyone learns the wrong lesson: “See? The system works eventually.”'
    ],
    tell: [
      'Press conference framed like a victory lap, not an apology.',
      'No specifics about prior complaints — “due to confidentiality.”',
      'Leaders congratulate themselves on “transparency,” while withholding documents.',
      'Anyone who mentions the cover-up gets called “divisive.”'
    ]
  }

]; // end covers[]


/* DOM REFS */
const coverListEl = document.getElementById('coverList');
const searchInputEl = document.getElementById('searchInput');

const coverNameEl = document.getElementById('coverName');
const coverTaglineEl = document.getElementById('coverTagline');
const coverAngleEl = document.getElementById('coverAngle');
const coverProfileEl = document.getElementById('coverProfile');
const coverSectionsEl = document.getElementById('coverSections');

/* accordion tracking */
function registerOpen(card) {
  if (!openCards.includes(card)) {
    openCards.push(card);
  }
  if (openCards.length > 2) {
    const toClose = openCards.shift();
    if (toClose && toClose !== card) {
      toClose.classList.remove('open');
    }
  }
}
function unregister(card) {
  openCards = openCards.filter(c => c !== card);
}

/* build accordion card */
function buildSectionCard(title, hint, bullets, open=false) {
  const card = document.createElement('div');
  card.className = 'section-card' + (open ? ' open' : '');

  const headerBtn = document.createElement('button');
  headerBtn.className = 'section-header';

  const labelWrap = document.createElement('div');
  labelWrap.className = 'label';

  const titleLine = document.createElement('div');
  titleLine.className = 'title-line';

  const titleSpan = document.createElement('div');
  titleSpan.className = 'section-title';
  titleSpan.textContent = title;

  const hintSpan = document.createElement('div');
  hintSpan.className = 'hint';
  hintSpan.textContent = hint;

  titleLine.appendChild(titleSpan);
  labelWrap.appendChild(titleLine);
  labelWrap.appendChild(hintSpan);

  const chev = document.createElement('div');
  chev.className = 'chevron';
  chev.textContent = '▶';

  headerBtn.appendChild(labelWrap);
  headerBtn.appendChild(chev);

  const bodyDiv = document.createElement('div');
  bodyDiv.className = 'section-body';

  const ul = document.createElement('ul');
  bullets.forEach(b => {
    const li = document.createElement('li');
    li.innerHTML = b.replace(/^([^:]+):/, '<strong>$1:</strong>');
    ul.appendChild(li);
  });
  bodyDiv.appendChild(ul);

  headerBtn.addEventListener('click', () => {
    const isOpen = card.classList.contains('open');
    if (isOpen) {
      card.classList.remove('open');
      unregister(card);
    } else {
      card.classList.add('open');
      registerOpen(card);
    }
  });

  card.appendChild(headerBtn);
  card.appendChild(bodyDiv);

  if (open) {
    registerOpen(card);
  }

  return card;
}

/* render sidebar list */
function renderCoverList(filterText = '') {
  const f = filterText.trim().toLowerCase();
  coverListEl.innerHTML = '';

  covers
    .filter(c => {
      if (!f) return true;
      const haystack = [
        c.name,
        c.shortDesc,
        c.tagline,
        c.angle
      ].join(' ').toLowerCase();
      return haystack.includes(f);
    })
    .forEach(c => {
      const item = document.createElement('div');
      item.className = 'cover-item';
      item.setAttribute('data-id', c.id);

      const line1 = document.createElement('div');
      line1.className = 'cover-line1';

      const nameSpan = document.createElement('div');
      nameSpan.className = 'cover-name';
      nameSpan.textContent = c.name;

      const tagSpan = document.createElement('div');
      tagSpan.className = 'cover-tag';
      tagSpan.textContent = c.tagline;

      line1.appendChild(nameSpan);
      line1.appendChild(tagSpan);

      const descDiv = document.createElement('div');
      descDiv.className = 'cover-desc';
      descDiv.textContent = c.shortDesc;

      item.appendChild(line1);
      item.appendChild(descDiv);

      item.addEventListener('click', () => {
        showCover(c.id);
      });

      coverListEl.appendChild(item);
    });

  highlightActive(currentCoverId);
}

/* show selected cover pattern in main panel */
function showCover(id) {
  const c = covers.find(x => x.id === id);
  if (!c) return;

  currentCoverId = id;

  coverNameEl.textContent = c.name;
  coverTaglineEl.textContent = c.tagline;
  coverAngleEl.textContent = c.angle;
  coverProfileEl.textContent = c.profile;

  coverSectionsEl.innerHTML = '';
  openCards = [];

  const sectionsData = [
    {title: 'How It Works', hint: 'Internal choreography', arr: c.method || []},
    {title: 'Why They Do It', hint: 'Motive is always image control', arr: c.whyDone || []},
    {title: 'Official Language', hint: 'Phrases that mean “shut up”', arr: c.phrases || []},
    {title: 'Collateral Damage', hint: 'Who pays for the cover', arr: c.damage || []},
    {title: 'How To Spot It', hint: 'Red flags in the wild', arr: c.tell || []},
  ];

  sectionsData.forEach((block, idx) => {
    if (!block.arr || block.arr.length === 0) return;
    const card = buildSectionCard(
      block.title,
      block.hint,
      block.arr,
      (idx === 0 || idx === 1)
    );
    coverSectionsEl.appendChild(card);
  });

  highlightActive(id);

  document.getElementById('main').scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

/* highlight selected in sidebar */
function highlightActive(id) {
  const items = coverListEl.querySelectorAll('.cover-item');
  items.forEach(el => {
    if (el.getAttribute('data-id') === id) {
      el.classList.add('active');
    } else {
      el.classList.remove('active');
    }
  });
}

/* search hook */
searchInputEl.addEventListener('input', (e) => {
  renderCoverList(e.target.value);
});

/* init */
renderCoverList('');
if (covers.length > 0) {
  showCover(covers[0].id);
}
</script>

</body>
</html>
