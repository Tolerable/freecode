<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitten Civilization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            gap: 20px;
            min-height: calc(100vh - 40px);
        }

        .panel {
            background: rgba(52, 73, 94, 0.9);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #3498db;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .main-panel {
            background: rgba(44, 62, 80, 0.9);
        }

        h1 {
            text-align: center;
            color: #f39c12;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        h2 {
            color: #e74c3c;
            margin-bottom: 15px;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 5px;
        }

        h3 {
            color: #3498db;
            margin-bottom: 10px;
        }

        .resource {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }

        .resource-name {
            font-weight: bold;
        }

        .resource-amount {
            color: #2ecc71;
            font-family: 'Courier New', monospace;
        }

        .production-rate {
            color: #f1c40f;
            font-size: 0.8em;
            font-style: italic;
        }

        .action-button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .building-button {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .building-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(230, 126, 34, 0.4);
        }

        .tech-button {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .tech-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
        }

        .religion-button {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .religion-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .cost-display {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .building-item, .tech-item, .religion-item {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
            border-left: 4px solid;
        }

        .building-item {
            border-left-color: #e67e22;
        }

        .tech-item {
            border-left-color: #9b59b6;
        }

        .religion-item {
            border-left-color: #f39c12;
        }

        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #34495e;
        }

        .tab {
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            color: #bdc3c7;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            flex: 1;
        }

        .tab:first-child {
            border-radius: 5px 0 0 0;
        }

        .tab:last-child {
            border-radius: 0 5px 0 0;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .achievement {
            padding: 8px;
            margin: 5px 0;
            background: rgba(46, 204, 113, 0.2);
            border-radius: 5px;
            border-left: 4px solid #2ecc71;
            font-size: 12px;
        }

        .achievement.new {
            animation: achievementPop 0.5s ease-out;
        }

        @keyframes achievementPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .log-entry {
            padding: 5px;
            margin: 2px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
            font-size: 12px;
            border-left: 3px solid #3498db;
        }

        .save-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .save-button {
            padding: 8px 15px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .save-button:hover {
            background: #2ecc71;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .field-display {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .field-title {
            color: #2ecc71;
            font-weight: bold;
            font-size: 16px;
        }

        .sell-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .sell-button:hover {
            background: #c0392b;
        }

        .field-effects {
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="save-controls">
        <button class="save-button" onclick="saveGame()">Save Game</button>
        <button class="save-button" onclick="loadGame()">Load Game</button>
        <button class="save-button" onclick="resetGame()">Reset Game</button>
    </div>

    <div class="container">
        <!-- Left Panel: Resources -->
        <div class="panel">
            <h2>Resources</h2>
            <div id="resources">
                <div class="resource">
                    <span class="resource-name">Catnip</span>
                    <div>
                        <span class="resource-amount" id="catnip-amount">0</span>
                        <div class="production-rate" id="catnip-rate">+0.0/sec</div>
                    </div>
                </div>
            </div>

            <h3>Population</h3>
            <div class="resource">
                <span class="resource-name">Kittens</span>
                <span class="resource-amount" id="kittens-amount">1</span>
            </div>
            <div class="resource">
                <span class="resource-name">Happiness</span>
                <span class="resource-amount" id="happiness-amount">100%</span>
            </div>

            <!-- Catnip Fields Summary -->
            <div id="catnip-fields-summary" class="hidden">
                <h3>Catnip Fields</h3>
                <div class="resource">
                    <span class="resource-name">Fields</span>
                    <div>
                        <span class="resource-amount" id="total-fields">0</span>
                        <div class="production-rate" id="fields-production">+0.0/sec</div>
                    </div>
                </div>
            </div>

            <h3>Recent Achievements</h3>
            <div id="achievements-list"></div>
        </div>

        <!-- Main Panel: Actions and Buildings -->
        <div class="panel main-panel">
            <h1>🐱 Kitten Civilization 🐱</h1>
            
            <div class="tab-container">
                <button class="tab active" onclick="showTab('gather')">Gather</button>
                <button class="tab" onclick="showTab('buildings')">Buildings</button>
                <button class="tab" onclick="showTab('technology')">Technology</button>
                <button class="tab" onclick="showTab('religion')">Religion</button>
                <button class="tab" onclick="showTab('trade')">Trade</button>
            </div>

            <!-- Gathering Tab -->
            <div id="gather-tab" class="tab-content active">
                <h3>Basic Actions</h3>
                <button class="action-button" onclick="gatherCatnip()" id="gather-catnip-btn">
                    Gather catnip
                    <div class="cost-display">Gather some catnip from the forest</div>
                </button>
                
                <button class="action-button hidden" id="plant-catnip-btn" onclick="plantCatnip()">
                    Plant catnip field
                    <div class="cost-display">Plant catnip to grow automatically (Cost: 10 catnip)</div>
                </button>
                
                <button class="action-button hidden" id="refine-catnip-btn" onclick="refineCatnip()">
                    Refine catnip
                    <div class="cost-display">Turn 1 catnip into catnip wood (Cost: 100 catnip)</div>
                </button>

                <button class="action-button hidden" id="hunt-btn" onclick="hunt()">
                    Send hunters
                    <div class="cost-display">Hunt for furs and ivory</div>
                </button>

                <button class="action-button hidden" id="observe-stars-btn" onclick="observeStars()">
                    Observe the sky
                    <div class="cost-display">Study the stars for science</div>
                </button>
            </div>

            <!-- Buildings Tab -->
            <div id="buildings-tab" class="tab-content">
                <h3>Buildings</h3>
                <div id="buildings-list">
                    <!-- Buildings will be dynamically added here -->
                </div>
            </div>

            <!-- Technology Tab -->
            <div id="technology-tab" class="tab-content">
                <h3>Research</h3>
                <div id="tech-list">
                    <!-- Technologies will be dynamically added here -->
                </div>
            </div>

            <!-- Religion Tab -->
            <div id="religion-tab" class="tab-content">
                <h3>Spiritual Development</h3>
                <div id="religion-list">
                    <!-- Religious options will be dynamically added here -->
                </div>
            </div>

            <!-- Trade Tab -->
            <div id="trade-tab" class="tab-content">
                <h3>Trading Post</h3>
                <p>Build a trading post to unlock trade with other civilizations...</p>
            </div>
        </div>

        <!-- Right Panel: Log and Status -->
        <div class="panel">
            <h2>Civilization Status</h2>
            <div id="status-info">
                <p><strong>Season:</strong> <span id="current-season">Spring</span></p>
                <p><strong>Year:</strong> <span id="current-year">1</span></p>
                <p><strong>Faith:</strong> <span id="faith-amount">0</span></p>
                <p><strong>Science:</strong> <span id="science-amount">0</span></p>
            </div>

            <h3>Activity Log</h3>
            <div id="game-log">
                <div class="log-entry">Welcome to your kitten civilization! Click 'Gather catnip' to begin.</div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            resources: {
                catnip: 0,
                wood: 0,
                minerals: 0,
                coal: 0,
                iron: 0,
                gold: 0,
                stone: 0,
                science: 0,
                faith: 0,
                furs: 0,
                ivory: 0,
                unicorns: 0
            },
            resourcesProduction: {
                catnip: 0,
                wood: 0,
                minerals: 0,
                coal: 0,
                iron: 0,
                gold: 0,
                stone: 0,
                science: 0,
                faith: 0
            },
            resourceLimits: {
                catnip: 1000,
                wood: 200,
                minerals: 250,
                coal: 150,
                iron: 100,
                gold: 50,
                stone: 250,
                science: 1000,
                faith: 100,
                furs: 200,
                ivory: 50,
                unicorns: 10
            },
            population: {
                kittens: 1,
                happiness: 1.0,
                engineers: 0,
                farmers: 0,
                scholars: 0,
                priests: 0,
                hunters: 0
            },
            buildings: {
                hut: 0,
                logHouse: 0,
                mansion: 0,
                library: 0,
                temple: 0,
                workshop: 0,
                barn: 0,
                warehouse: 0,
                mine: 0,
                quarry: 0,
                catnipFields: 0,
                observatory: 0,
                academy: 0
            },
            technologies: {
                agriculture: false,
                archery: false,
                mining: false,
                metalWorking: false,
                construction: false,
                engineering: false,
                astronomy: false,
                theology: false,
                philosophy: false,
                mathematics: false,
                optics: false,
                physics: false
            },
            religion: {
                faithLevel: 0,
                solarRevolution: false,
                scholasticism: false,
                goldenRatio: false,
                sunAltar: 0,
                moonAltar: 0,
                transcendence: 0
            },
            stats: {
                totalCatnipGathered: 0,
                totalCatnipRefined: 0,
                timePlayed: 0,
                achievements: [],
                season: 0, // 0=spring, 1=summer, 2=autumn, 3=winter
                year: 1,
                gatherClicks: 0
            }
        };

        // Building Definitions
        const buildingDefs = {
            catnipField: {
                name: "Catnip Field",
                description: "Plant catnip that grows automatically",
                cost: { catnip: 10 },
                effect: "+0.63 catnip per second",
                unlocked: () => gameState.stats.gatherClicks >= 5,
                onBuild: () => { 
                    const currentFields = gameState.buildings.catnipField;
                    // Scaling cost - each field costs 25% more
                    const scalingMultiplier = Math.pow(1.25, currentFields);
                    buildingDefs.catnipField.cost.catnip = Math.floor(10 * scalingMultiplier);
                    
                    gameState.resourcesProduction.catnip += 0.63;
                    updateGatherButton();
                }
            },
            hut: {
                name: "Hut",
                description: "A small hut for kittens",
                cost: { wood: 5 },
                effect: "Houses 2 kittens",
                unlocked: () => gameState.resources.wood >= 5,
                onBuild: () => { gameState.population.kittens += 2; }
            },
            library: {
                name: "Library", 
                description: "A place of learning and research",
                cost: { wood: 25 },
                effect: "+0.1 science per second, unlocks research",
                unlocked: () => gameState.resources.wood >= 20,
                onBuild: () => { 
                    gameState.resourcesProduction.science += 0.1;
                    // Give some starting science to kickstart research
                    gameState.resources.science += 5;
                }
            },
            barn: {
                name: "Barn",
                description: "Stores catnip and food",
                cost: { wood: 50 },
                effect: "+5000 catnip storage, +1000 wood storage",
                unlocked: () => gameState.buildings.hut >= 2,
                onBuild: () => { 
                    gameState.resourceLimits.catnip += 5000;
                    gameState.resourceLimits.wood += 1000;
                    gameState.resourceLimits.furs += 500;
                }
            },
            warehouse: {
                name: "Warehouse", 
                description: "Stores minerals, coal, and stone",
                cost: { wood: 150, stone: 100 },
                effect: "+2000 mineral storage, +1500 coal storage",
                unlocked: () => gameState.resources.stone >= 50,
                onBuild: () => {
                    gameState.resourceLimits.minerals += 2000;
                    gameState.resourceLimits.coal += 1500;
                    gameState.resourceLimits.stone += 2000;
                    gameState.resourceLimits.iron += 500;
                }
            },
            mine: {
                name: "Mine",
                description: "Extracts minerals and coal from the earth",
                cost: { wood: 100 },
                effect: "+0.05 minerals/sec, +0.02 coal/sec",
                unlocked: () => gameState.technologies.mining,
                onBuild: () => { 
                    gameState.resourcesProduction.minerals = (gameState.resourcesProduction.minerals || 0) + 0.05;
                    gameState.resourcesProduction.coal = (gameState.resourcesProduction.coal || 0) + 0.02;
                }
            },
            quarry: {
                name: "Quarry",
                description: "Extracts stone and more minerals",
                cost: { wood: 50, minerals: 25 },
                effect: "+0.1 minerals/sec, +0.05 stone/sec",
                unlocked: () => gameState.resources.minerals >= 15 || gameState.buildings.mine >= 1,
                onBuild: () => { 
                    gameState.resourcesProduction.minerals = (gameState.resourcesProduction.minerals || 0) + 0.1;
                    gameState.resourcesProduction.stone = (gameState.resourcesProduction.stone || 0) + 0.05;
                }
            },
            goldMine: {
                name: "Gold Mine",
                description: "Extracts precious gold",
                cost: { wood: 200, minerals: 150, coal: 50 },
                effect: "+0.01 gold/sec",
                unlocked: () => gameState.technologies.metalWorking && gameState.buildings.mine >= 2,
                onBuild: () => { 
                    gameState.resourcesProduction.gold = (gameState.resourcesProduction.gold || 0) + 0.01;
                }
            },
            workshop: {
                name: "Workshop",
                description: "Advanced crafting building",
                cost: { wood: 100, minerals: 100 },
                effect: "Enables advanced crafting and smelting",
                unlocked: () => gameState.technologies.engineering,
                onBuild: () => { 
                    showElement('refine-catnip-btn');
                    // Workshop also provides some iron through smelting
                    gameState.resourcesProduction.iron = (gameState.resourcesProduction.iron || 0) + 0.01;
                }
            },
            smelter: {
                name: "Smelter",
                description: "Smelt coal and minerals into iron",
                cost: { wood: 200, minerals: 200, coal: 100 },
                effect: "+0.05 iron/sec",
                unlocked: () => gameState.technologies.metalWorking && gameState.buildings.workshop >= 1,
                onBuild: () => { 
                    gameState.resourcesProduction.iron = (gameState.resourcesProduction.iron || 0) + 0.05;
                }
            },
            temple: {
                name: "Temple",
                description: "A sacred place of worship to Babs",
                cost: { wood: 50, gold: 25 },
                effect: "+0.1 faith per second",
                unlocked: () => gameState.resources.gold >= 20,
                onBuild: () => { 
                    gameState.resourcesProduction.faith += 0.1;
                    // Give some starting faith
                    gameState.resources.faith += 5;
                }
            },
            logHouse: {
                name: "Log House",
                description: "A sturdy log house for more kittens",
                cost: { wood: 200, minerals: 250 },
                effect: "Houses 6 kittens, +10% happiness",
                unlocked: () => gameState.technologies.construction,
                onBuild: () => { 
                    gameState.population.kittens += 6; 
                    gameState.population.happiness += 0.1;
                }
            },
            academy: {
                name: "Academy",
                description: "Advanced learning institution",
                cost: { wood: 200, minerals: 100, science: 500 },
                effect: "+1.0 science per second, reduces tech costs",
                unlocked: () => gameState.buildings.library >= 2 && gameState.resources.science >= 200,
                onBuild: () => { 
                    gameState.resourcesProduction.science += 1.0;
                }
            },
            pasture: {
                name: "Pasture",
                description: "Raise unicorns and other creatures",
                cost: { wood: 50, catnip: 500 },
                effect: "Enables unicorn farming, +happiness",
                unlocked: () => gameState.resources.unicorns >= 1 || gameState.resources.ivory >= 10,
                onBuild: () => {
                    gameState.population.happiness += 0.05;
                    gameState.resourcesProduction.unicorns = 0.001; // Very slow unicorn production
                }
            },
            tradingPost: {
                name: "Trading Post",
                description: "Trade with other civilizations",
                cost: { wood: 500, minerals: 200, gold: 15 },
                effect: "Unlocks trading and exotic resources",
                unlocked: () => gameState.resources.gold >= 10 && gameState.resources.furs >= 50,
                onBuild: () => {
                    logMessage("🏪 Trading post built! New trading opportunities available.");
                }
            },
            observatory: {
                name: "Observatory",
                description: "Study the heavens and stars",
                cost: { wood: 200, minerals: 100, iron: 50 },
                effect: "+0.25 science per second, enables star observation",
                unlocked: () => gameState.technologies.astronomy,
                onBuild: () => { 
                    gameState.resourcesProduction.science += 0.25; 
                    showElement('observe-stars-btn');
                }
            }
        };

        // Technology Definitions
        const techDefs = {
            agriculture: {
                name: "Agriculture",
                description: "Learn to farm efficiently",
                cost: { science: 10 },
                effect: "Improves catnip production by +50%",
                unlocked: () => gameState.resources.science >= 5,
                onResearch: () => { 
                    gameState.resourcesProduction.catnip += 0.5;
                    logMessage("🌾 Agriculture improves your catnip production!");
                }
            },
            calendar: {
                name: "Calendar",
                description: "Track seasons and time accurately",
                cost: { science: 30 },
                effect: "Reduces seasonal penalties by 25%",
                unlocked: () => gameState.resources.science >= 15,
                onResearch: () => { 
                    logMessage("📅 Calendar helps predict and prepare for seasons!");
                }
            },
            archery: {
                name: "Archery", 
                description: "Hunt more effectively with bows",
                cost: { science: 25 },
                effect: "Unlocks hunting for furs and ivory",
                unlocked: () => gameState.resources.science >= 15,
                onResearch: () => { 
                    showElement('hunt-btn');
                    logMessage("🏹 Your kittens can now hunt!");
                }
            },
            mining: {
                name: "Mining",
                description: "Extract minerals and coal from the earth",
                cost: { science: 50 },
                effect: "Unlocks mines and mineral extraction",
                unlocked: () => gameState.resources.science >= 25,
                onResearch: () => { 
                    logMessage("⛏️ Mining unlocked! You can now build mines.");
                }
            },
            astronomy: {
                name: "Astronomy", 
                description: "Study the stars and celestial bodies",
                cost: { science: 150 },
                effect: "Unlocks observatory and star charts",
                unlocked: () => gameState.resources.science >= 75,
                onResearch: () => { 
                    logMessage("🌟 Astronomy unlocked! You can now build observatories.");
                }
            },
            construction: {
                name: "Construction",
                description: "Build better structures",
                cost: { science: 100 },
                effect: "Unlocks advanced buildings like log houses",
                unlocked: () => gameState.resources.science >= 50,
                onResearch: () => { 
                    logMessage("🏗️ Construction unlocked! Better buildings available.");
                }
            },
            metalWorking: {
                name: "Metal Working",
                description: "Work with iron and gold",
                cost: { science: 125 },
                effect: "Unlocks smelters and gold mining",
                unlocked: () => gameState.technologies.mining && gameState.resources.science >= 75,
                onResearch: () => { 
                    logMessage("🔨 Metal working unlocked! Advanced mining and smelting available.");
                }
            },
            engineering: {
                name: "Engineering",
                description: "Advanced mechanical knowledge",
                cost: { science: 200 },
                effect: "Unlocks workshops and automation",
                unlocked: () => gameState.resources.science >= 100,
                onResearch: () => { 
                    logMessage("⚙️ Engineering unlocked! Workshops and automation available.");
                }
            },
            theology: {
                name: "Theology",
                description: "Deepen understanding of Babs' teachings",
                cost: { science: 75, faith: 25 },
                effect: "Improves faith generation by +0.2/sec",
                unlocked: () => gameState.resources.faith >= 10,
                onResearch: () => { 
                    gameState.resourcesProduction.faith += 0.2;
                    logMessage("🙏 Theology deepens your faith in Babs!");
                }
            }
        };

        // Religion Definitions
        const religionDefs = {
            sunAltar: {
                name: "Sun Altar to Babs",
                description: "A gleaming altar to the cat goddess",
                cost: { gold: 50, faith: 100 },
                effect: "+0.5 faith per second",
                unlocked: () => gameState.resources.faith >= 50,
                onBuild: () => { gameState.resourcesProduction.faith += 0.5; }
            },
            solarRevolution: {
                name: "Solar Revolution",
                description: "Harness the power of Babs' light",
                cost: { faith: 250 },
                effect: "All resource production +25%",
                unlocked: () => gameState.technologies.theology,
                onPurchase: () => { 
                    // Multiply all production by 1.25
                    for (let resource in gameState.resourcesProduction) {
                        gameState.resourcesProduction[resource] *= 1.25;
                    }
                }
            },
            transcendence: {
                name: "Transcendence",
                description: "Achieve oneness with Babs",
                cost: { faith: 1000, unicorns: 10 },
                effect: "Reset progress but gain powerful bonuses",
                unlocked: () => gameState.resources.unicorns >= 1,
                onPurchase: () => { 
                    // This would trigger a "prestige" reset
                    logMessage("You have achieved transcendence! Your civilization ascends to a higher plane...");
                }
            }
        };

        // Achievement Definitions
        const achievements = [
            { id: 'first_catnip', name: 'First Catnip', desc: 'Gather your first catnip', trigger: () => gameState.stats.totalCatnipGathered >= 1 },
            { id: 'catnip_hoarder', name: 'Catnip Hoarder', desc: 'Gather 100 catnip', trigger: () => gameState.stats.totalCatnipGathered >= 100 },
            { id: 'first_building', name: 'Architect', desc: 'Build your first structure', trigger: () => Object.values(gameState.buildings).some(count => count > 0) },
            { id: 'first_tech', name: 'Scholar', desc: 'Research your first technology', trigger: () => Object.values(gameState.technologies).some(researched => researched) },
            { id: 'faithful', name: 'Faithful Servant', desc: 'Accumulate 10 faith', trigger: () => gameState.resources.faith >= 10 },
            { id: 'population_growth', name: 'Growing Tribe', desc: 'Reach 10 kittens', trigger: () => gameState.population.kittens >= 10 },
            { id: 'year_survivor', name: 'One Year Strong', desc: 'Survive your first year', trigger: () => gameState.stats.year >= 2 },
            { id: 'dedicated_clicker', name: 'Dedicated Gatherer', desc: 'Click gather 100 times', trigger: () => gameState.stats.gatherClicks >= 100 }
        ];

        // Game Functions
        function gatherCatnip() {
            const amount = Math.random() * 3 + 1; // 1-4 catnip per click
            gameState.resources.catnip += amount;
            gameState.stats.totalCatnipGathered += amount;
            gameState.stats.gatherClicks++;
            
            logMessage(`You gathered ${amount.toFixed(1)} catnip.`);
            updateGatherButton();
            
            checkAchievements();
            updateDisplay();
        }

        function updateGatherButton() {
            const gatherBtn = document.getElementById('gather-catnip-btn');
            const plantBtn = document.getElementById('plant-catnip-btn');
            
            if (gameState.buildings.catnipField >= 10) {
                gatherBtn.innerHTML = `
                    Gather catnip
                    <div class="cost-display">Your fields provide enough catnip. Focus on other tasks!</div>
                `;
            } else if (gameState.stats.gatherClicks >= 5) {
                showElement('plant-catnip-btn');
                gatherBtn.innerHTML = `
                    Gather catnip
                    <div class="cost-display">Consider planting fields for automatic catnip!</div>
                `;
            } else if (gameState.stats.gatherClicks >= 3) {
                showElement('refine-catnip-btn');
            }
        }

        function plantCatnip() {
            if (gameState.resources.catnip >= 10) {
                gameState.resources.catnip -= 10;
                gameState.buildings.catnipField++;
                gameState.resourcesProduction.catnip += 0.63;
                logMessage("You planted a catnip field! It will grow catnip automatically.");
                
                // Show field management section
                showElement('field-management');
                updateFieldDisplay();
                updateDisplay();
            }
        }

        function sellCatnipField() {
            if (gameState.buildings.catnipField > 0) {
                gameState.buildings.catnipField--;
                gameState.resourcesProduction.catnip = Math.max(0, gameState.resourcesProduction.catnip - 0.63);
                gameState.resources.catnip += 5; // Get half back when selling
                logMessage("You sold a catnip field for 5 catnip.");
                
                if (gameState.buildings.catnipField === 0) {
                    document.getElementById('field-management').classList.add('hidden');
                }
                
                updateFieldDisplay();
                updateDisplay();
            }
        }

        function updateFieldDisplay() {
            const fieldsDisplay = document.getElementById('catnip-fields-display');
            if (gameState.buildings.catnipField > 0) {
                const totalProduction = (gameState.buildings.catnipField * 0.63).toFixed(2);
                const seasonMultipliers = [1.5, 1.0, 0.75, 0.25];
                const seasonalProduction = (totalProduction * seasonMultipliers[gameState.stats.season]).toFixed(2);
                const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
                
                fieldsDisplay.innerHTML = `
                    <div class="field-display">
                        <div class="field-header">
                            <span class="field-title">Catnip Field (${gameState.buildings.catnipField})</span>
                            <button class="sell-button" onclick="sellCatnipField()">sell</button>
                        </div>
                        <p>Plant some catnip to grow in the village.<br>
                        Fields have +50% production in Spring and -75% production in Winter</p>
                        <div class="field-effects">
                            <div class="effect-line">Effects:</div>
                            <div class="effect-line">Catnip production: ${seasonalProduction}/sec (${seasons[gameState.stats.season]})</div>
                            <div class="effect-line">Base production: ${totalProduction}/sec</div>
                        </div>
                    </div>
                `;
            }
        }

        function refineCatnip() {
            if (gameState.resources.catnip >= 100) {
                gameState.resources.catnip -= 100;
                gameState.resources.wood += 1;
                gameState.stats.totalCatnipRefined++;
                logMessage("You refined 100 catnip into 1 wood.");
                updateDisplay();
            }
        }

        function hunt() {
            if (Math.random() < 0.7) {
                const furs = Math.floor(Math.random() * 3) + 1;
                gameState.resources.furs += furs;
                logMessage(`Your hunters returned with ${furs} furs!`);
            } else {
                logMessage("Your hunters returned empty-pawed.");
            }
            
            if (Math.random() < 0.1) {
                gameState.resources.ivory += 1;
                logMessage("Your hunters found ivory!");
            }
            
            updateDisplay();
        }

        function observeStars() {
            if (gameState.buildings.observatory > 0) {
                const science = Math.random() * 5 + 2;
                gameState.resources.science += science;
                logMessage(`Observing the stars grants ${science.toFixed(1)} science.`);
                
                if (Math.random() < 0.01) {
                    gameState.resources.unicorns += 1;
                    logMessage("A unicorn appears from the cosmic void!");
                }
                updateDisplay();
            }
        }

        function buildBuilding(buildingKey) {
            const building = buildingDefs[buildingKey];
            if (!building) return;
            
            // Check if we can afford it
            let canAfford = true;
            for (let resource in building.cost) {
                if (gameState.resources[resource] < building.cost[resource]) {
                    canAfford = false;
                    break;
                }
            }
            
            if (!canAfford) return;
            
            // Pay the cost
            for (let resource in building.cost) {
                gameState.resources[resource] -= building.cost[resource];
            }
            
            // Build it
            gameState.buildings[buildingKey]++;
            building.onBuild();
            
            logMessage(`Built a ${building.name}!`);
            checkAchievements();
            updateDisplay();
        }

        function researchTech(techKey) {
            const tech = techDefs[techKey];
            if (!tech || gameState.technologies[techKey]) return;
            
            // Check if we can afford it
            let canAfford = true;
            for (let resource in tech.cost) {
                if (gameState.resources[resource] < tech.cost[resource]) {
                    canAfford = false;
                    break;
                }
            }
            
            if (!canAfford) return;
            
            // Pay the cost
            for (let resource in tech.cost) {
                gameState.resources[resource] -= tech.cost[resource];
            }
            
            // Research it
            gameState.technologies[techKey] = true;
            tech.onResearch();
            
            logMessage(`Researched ${tech.name}!`);
            checkAchievements();
            updateDisplay();
        }

        function purchaseReligion(religionKey) {
            const religion = religionDefs[religionKey];
            if (!religion) return;
            
            // Check if we can afford it
            let canAfford = true;
            for (let resource in religion.cost) {
                if (gameState.resources[resource] < religion.cost[resource]) {
                    canAfford = false;
                    break;
                }
            }
            
            if (!canAfford) return;
            
            // Pay the cost
            for (let resource in religion.cost) {
                gameState.resources[resource] -= religion.cost[resource];
            }
            
            // Purchase it
            if (religionKey === 'sunAltar') {
                gameState.religion.sunAltar++;
            } else {
                gameState.religion[religionKey] = true;
            }
            
            religion.onPurchase?.();
            
            logMessage(`Acquired ${religion.name}!`);
            updateDisplay();
        }

        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Show selected tab button
            event.target.classList.add('active');
        }

        function showElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.remove('hidden');
            }
        }

        function updateDisplay() {
            // Update resources with storage info
            for (let resource in gameState.resources) {
                const element = document.getElementById(resource + '-amount');
                if (element) {
                    const current = Math.floor(gameState.resources[resource]);
                    const limit = gameState.resourceLimits[resource];
                    if (limit && limit < Infinity) {
                        element.textContent = `${current.toLocaleString()}/${limit.toLocaleString()}`;
                        // Color code based on capacity
                        if (current >= limit * 0.9) {
                            element.style.color = '#e74c3c'; // Red when nearly full
                        } else if (current >= limit * 0.75) {
                            element.style.color = '#f39c12'; // Orange when 75% full
                        } else {
                            element.style.color = '#2ecc71'; // Green when plenty of space
                        }
                    } else {
                        element.textContent = current.toLocaleString();
                        element.style.color = '#2ecc71';
                    }
                }
                
                const rateElement = document.getElementById(resource + '-rate');
                if (rateElement && gameState.resourcesProduction[resource]) {
                    let rate = gameState.resourcesProduction[resource];
                    
                    // Apply seasonal effects for display
                    if (resource === 'catnip') {
                        const seasonMultipliers = [1.5, 1.0, 0.75, 0.25];
                        rate *= seasonMultipliers[gameState.stats.season];
                    }
                    
                    rateElement.textContent = rate > 0 ? `+${rate.toFixed(2)}/sec` : '';
                }
            }
            
            // Update population
            document.getElementById('kittens-amount').textContent = Math.floor(gameState.population.kittens);
            document.getElementById('happiness-amount').textContent = Math.floor(gameState.population.happiness * 100) + '%';
            
            // Update catnip fields summary
            updateCatnipFieldsSummary();
            
            // Update status
            const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
            document.getElementById('current-season').textContent = seasons[gameState.stats.season];
            document.getElementById('current-year').textContent = gameState.stats.year;
            document.getElementById('faith-amount').textContent = Math.floor(gameState.resources.faith);
            document.getElementById('science-amount').textContent = Math.floor(gameState.resources.science);
            
            // Update buildings list
            updateBuildingsList();
            updateTechList();
            updateReligionList();
            updateFieldDisplay();
        }

        function updateCatnipFieldsSummary() {
            const fieldsCount = gameState.buildings.catnipField || 0;
            if (fieldsCount > 0) {
                showElement('catnip-fields-summary');
                document.getElementById('total-fields').textContent = fieldsCount;
                
                const baseProduction = fieldsCount * 0.63;
                const seasonMultipliers = [1.5, 1.0, 0.75, 0.25];
                const currentProduction = baseProduction * seasonMultipliers[gameState.stats.season];
                
                document.getElementById('fields-production').textContent = `+${currentProduction.toFixed(2)}/sec`;
            } else {
                document.getElementById('catnip-fields-summary').classList.add('hidden');
            }
        }

        function updateBuildingsList() {
            const buildingsList = document.getElementById('buildings-list');
            buildingsList.innerHTML = '';
            
            for (let buildingKey in buildingDefs) {
                const building = buildingDefs[buildingKey];
                const buildingCount = gameState.buildings[buildingKey] || 0;
                const isVisible = building.unlocked() || buildingCount > 0;
                
                if (isVisible) {
                    const div = document.createElement('div');
                    div.className = 'building-item';
                    
                    let canAfford = true;
                    let costText = '';
                    for (let resource in building.cost) {
                        if (gameState.resources[resource] < building.cost[resource]) {
                            canAfford = false;
                        }
                        costText += `${building.cost[resource]} ${resource}, `;
                    }
                    costText = costText.slice(0, -2); // Remove trailing comma
                    
                    // Show if already built or if can afford
                    const buttonDisabled = !canAfford;
                    const buttonClass = buttonDisabled ? 'building-button disabled' : 'building-button';
                    
                    div.innerHTML = `
                        <h4>${building.name} ${buildingCount > 0 ? `(${buildingCount})` : ''}</h4>
                        <p>${building.description}</p>
                        <p><strong>Effect:</strong> ${building.effect}</p>
                        ${buildingCount > 0 ? 
                            `<p style="color: #2ecc71;"><strong>✓ Built:</strong> ${buildingCount}</p>` : ''
                        }
                        <button class="action-button ${buttonClass}" 
                                onclick="buildBuilding('${buildingKey}')" 
                                ${buttonDisabled ? 'disabled' : ''}>
                            Build (${costText})
                        </button>
                    `;
                    buildingsList.appendChild(div);
                }
            }
            
            // Show "coming soon" buildings that are close to unlocking
            addComingSoonBuildings(buildingsList);
        }

        function addComingSoonBuildings(buildingsList) {
            const comingSoonDiv = document.createElement('div');
            comingSoonDiv.innerHTML = '<h3 style="color: #95a5a6; margin-top: 20px;">Coming Soon...</h3>';
            let hasComingSoon = false;
            
            for (let buildingKey in buildingDefs) {
                const building = buildingDefs[buildingKey];
                const buildingCount = gameState.buildings[buildingKey] || 0;
                const isCurrentlyVisible = building.unlocked() || buildingCount > 0;
                
                if (!isCurrentlyVisible && isCloseToUnlocking(buildingKey)) {
                    hasComingSoon = true;
                    const div = document.createElement('div');
                    div.className = 'building-item';
                    div.style.opacity = '0.6';
                    div.style.border = '2px dashed #7f8c8d';
                    
                    let costText = '';
                    for (let resource in building.cost) {
                        costText += `${building.cost[resource]} ${resource}, `;
                    }
                    costText = costText.slice(0, -2);
                    
                    div.innerHTML = `
                        <h4>${building.name} 🔒</h4>
                        <p>${building.description}</p>
                        <p><strong>Effect:</strong> ${building.effect}</p>
                        <p style="color: #f39c12;"><strong>Unlock Requirement:</strong> ${getUnlockHint(buildingKey)}</p>
                        <button class="action-button building-button" disabled>
                            Locked (${costText})
                        </button>
                    `;
                    comingSoonDiv.appendChild(div);
                }
            }
            
            if (hasComingSoon) {
                buildingsList.appendChild(comingSoonDiv);
            }
        }

        function isCloseToUnlocking(buildingKey) {
            const building = buildingDefs[buildingKey];
            
            // Show buildings that require technologies we're close to researching
            if (buildingKey === 'mine' && gameState.resources.science >= 25) return true;
            if (buildingKey === 'quarry' && (gameState.resources.minerals >= 10 || gameState.buildings.mine >= 1)) return true;
            if (buildingKey === 'shrine' && gameState.resources.stone >= 10) return true;
            if (buildingKey === 'warehouse' && gameState.resources.stone >= 25) return true;
            if (buildingKey === 'workshop' && gameState.resources.science >= 100) return true;
            if (buildingKey === 'smelter' && gameState.technologies.mining) return true;
            if (buildingKey === 'goldMine' && gameState.resources.science >= 75) return true;
            if (buildingKey === 'temple' && (gameState.resources.gold >= 5 || gameState.buildings.goldMine > 0)) return true;
            if (buildingKey === 'logHouse' && gameState.resources.science >= 75) return true;
            if (buildingKey === 'observatory' && gameState.resources.science >= 100) return true;
            if (buildingKey === 'academy' && gameState.buildings.library >= 1 && gameState.resources.science >= 100) return true;
            if (buildingKey === 'pasture' && (gameState.resources.ivory >= 5 || gameState.resources.unicorns >= 1)) return true;
            if (buildingKey === 'tradingPost' && gameState.resources.furs >= 25) return true;
            
            return false;
        }

        function getUnlockHint(buildingKey) {
            switch(buildingKey) {
                case 'mine': return 'Research Mining (50 science)';
                case 'quarry': return 'Have 15+ minerals OR build a mine';
                case 'shrine': return 'Gather 15+ stone (from quarries)';
                case 'warehouse': return 'Gather 50+ stone';
                case 'workshop': return 'Research Engineering (200 science)';
                case 'smelter': return 'Research Metal Working + Build Workshop';
                case 'goldMine': return 'Research Metal Working + Build 2 Mines';
                case 'temple': return 'Acquire 20+ gold (build Gold Mine)';
                case 'logHouse': return 'Research Construction (100 science)';
                case 'observatory': return 'Research Astronomy (150 science)';
                case 'academy': return 'Build 2+ Libraries + 200 science';
                case 'pasture': return 'Find unicorns or gather 10+ ivory';
                case 'tradingPost': return 'Gather 50+ furs + 10+ gold';
                default: return 'Requirements not met';
            }
        }

        function updateTechList() {
            const techList = document.getElementById('tech-list');
            techList.innerHTML = '';
            
            // Available technologies
            const availableDiv = document.createElement('div');
            availableDiv.innerHTML = '<h4>Available Research:</h4>';
            let hasAvailable = false;
            
            for (let techKey in techDefs) {
                const tech = techDefs[techKey];
                if (tech.unlocked() && !gameState.technologies[techKey]) {
                    hasAvailable = true;
                    const div = document.createElement('div');
                    div.className = 'tech-item';
                    
                    let canAfford = true;
                    let costText = '';
                    for (let resource in tech.cost) {
                        if (gameState.resources[resource] < tech.cost[resource]) {
                            canAfford = false;
                        }
                        costText += `${tech.cost[resource]} ${resource}, `;
                    }
                    costText = costText.slice(0, -2);
                    
                    div.innerHTML = `
                        <h4>${tech.name}</h4>
                        <p>${tech.description}</p>
                        <p><strong>Effect:</strong> ${tech.effect}</p>
                        <button class="action-button tech-button" 
                                onclick="researchTech('${techKey}')" 
                                ${!canAfford ? 'disabled' : ''}>
                            Research (${costText})
                        </button>
                    `;
                    availableDiv.appendChild(div);
                }
            }
            
            if (hasAvailable) {
                techList.appendChild(availableDiv);
            }
            
            // Researched technologies
            const researchedDiv = document.createElement('div');
            researchedDiv.innerHTML = '<h4 style="margin-top: 20px;">Researched Technologies:</h4>';
            let hasResearched = false;
            
            for (let techKey in gameState.technologies) {
                if (gameState.technologies[techKey] && techDefs[techKey]) {
                    hasResearched = true;
                    const p = document.createElement('p');
                    p.innerHTML = `✓ <strong>${techDefs[techKey].name}</strong> - ${techDefs[techKey].effect}`;
                    p.style.color = '#2ecc71';
                    p.style.margin = '8px 0';
                    researchedDiv.appendChild(p);
                }
            }
            
            if (hasResearched) {
                techList.appendChild(researchedDiv);
            }
            
            // Coming soon technologies  
            const comingSoonDiv = document.createElement('div');
            comingSoonDiv.innerHTML = '<h4 style="color: #95a5a6; margin-top: 20px;">Future Research:</h4>';
            let hasComingSoon = false;
            
            for (let techKey in techDefs) {
                const tech = techDefs[techKey];
                if (!tech.unlocked() && !gameState.technologies[techKey] && isCloseToResearching(techKey)) {
                    hasComingSoon = true;
                    const div = document.createElement('div');
                    div.className = 'tech-item';
                    div.style.opacity = '0.6';
                    div.style.border = '2px dashed #7f8c8d';
                    
                    let costText = '';
                    for (let resource in tech.cost) {
                        costText += `${tech.cost[resource]} ${resource}, `;
                    }
                    costText = costText.slice(0, -2);
                    
                    div.innerHTML = `
                        <h4>${tech.name} 🔒</h4>
                        <p>${tech.description}</p>
                        <p><strong>Effect:</strong> ${tech.effect}</p>
                        <p style="color: #f39c12;"><strong>Requirement:</strong> ${getResearchHint(techKey)}</p>
                        <button class="action-button tech-button" disabled>
                            Locked (${costText})
                        </button>
                    `;
                    comingSoonDiv.appendChild(div);
                }
            }
            
            if (hasComingSoon) {
                techList.appendChild(comingSoonDiv);
            }
        }

        function isCloseToResearching(techKey) {
            if (techKey === 'agriculture' && gameState.resources.science >= 2) return true;
            if (techKey === 'calendar' && gameState.resources.science >= 10) return true;
            if (techKey === 'archery' && gameState.resources.science >= 10) return true;
            if (techKey === 'mining' && gameState.resources.science >= 15) return true;
            if (techKey === 'construction' && gameState.resources.science >= 30) return true;
            if (techKey === 'astronomy' && gameState.resources.science >= 50) return true;
            if (techKey === 'metalWorking' && gameState.technologies.mining && gameState.resources.science >= 50) return true;
            if (techKey === 'engineering' && gameState.resources.science >= 75) return true;
            if (techKey === 'theology' && gameState.resources.faith >= 5) return true;
            return false;
        }

        function getResearchHint(techKey) {
            if (techKey === 'agriculture') return 'Need 5+ science';
            if (techKey === 'calendar') return 'Need 15+ science';
            if (techKey === 'archery') return 'Need 15+ science';
            if (techKey === 'mining') return 'Need 25+ science';
            if (techKey === 'construction') return 'Need 50+ science';
            if (techKey === 'astronomy') return 'Need 75+ science';
            if (techKey === 'metalWorking') return 'Need Mining + 75+ science';
            if (techKey === 'engineering') return 'Need 100+ science';
            if (techKey === 'theology') return 'Need 10+ faith';
            return 'Requirements not met';
        }

        function updateReligionList() {
            const religionList = document.getElementById('religion-list');
            religionList.innerHTML = '';
            
            if (gameState.resources.faith < 1) {
                religionList.innerHTML = '<p>You must gather faith before you can worship Babs, the great cat goddess...</p>';
                return;
            }
            
            religionList.innerHTML = '<p>🐱 <em>"In the beginning, there was Babs, the great black cat goddess who created all kittens in her divine image..."</em></p>';
            
            for (let religionKey in religionDefs) {
                const religion = religionDefs[religionKey];
                if (religion.unlocked()) {
                    const div = document.createElement('div');
                    div.className = 'religion-item';
                    
                    let canAfford = true;
                    let costText = '';
                    for (let resource in religion.cost) {
                        if (gameState.resources[resource] < religion.cost[resource]) {
                            canAfford = false;
                        }
                        costText += `${religion.cost[resource]} ${resource}, `;
                    }
                    costText = costText.slice(0, -2);
                    
                    const count = religionKey === 'sunAltar' ? ` (${gameState.religion.sunAltar})` : '';
                    const purchased = gameState.religion[religionKey] === true;
                    
                    div.innerHTML = `
                        <h4>${religion.name}${count}</h4>
                        <p>${religion.description}</p>
                        <p><strong>Effect:</strong> ${religion.effect}</p>
                        ${!purchased ? `
                            <button class="action-button religion-button" 
                                    onclick="purchaseReligion('${religionKey}')" 
                                    ${!canAfford ? 'disabled' : ''}>
                                ${religionKey === 'sunAltar' ? 'Build' : 'Purchase'} (${costText})
                            </button>
                        ` : '<p style="color: #2ecc71;">✓ Acquired</p>'}
                    `;
                    religionList.appendChild(div);
                }
            }
        }

        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!gameState.stats.achievements.includes(achievement.id) && achievement.trigger()) {
                    gameState.stats.achievements.push(achievement.id);
                    showAchievement(achievement);
                }
            });
        }

        function showAchievement(achievement) {
            const achievementsList = document.getElementById('achievements-list');
            const div = document.createElement('div');
            div.className = 'achievement new';
            div.setAttribute('data-achievement-id', achievement.id);
            div.innerHTML = `
                <strong>${achievement.name}</strong><br>
                <small>${achievement.desc}</small>
            `;
            achievementsList.insertBefore(div, achievementsList.firstChild);
            
            // Remove the "new" class after animation
            setTimeout(() => {
                div.classList.remove('new');
            }, 500);
            
            // Keep only last 5 achievements visible
            while (achievementsList.children.length > 5) {
                achievementsList.removeChild(achievementsList.lastChild);
            }
            
            logMessage(`🏆 Achievement Unlocked: ${achievement.name}`);
        }

        function loadAchievements() {
            const achievementsList = document.getElementById('achievements-list');
            achievementsList.innerHTML = '';
            
            // Show earned achievements (most recent first)
            const earnedAchievements = gameState.stats.achievements.slice().reverse().slice(0, 5);
            earnedAchievements.forEach(achievementId => {
                const achievement = achievements.find(a => a.id === achievementId);
                if (achievement) {
                    const div = document.createElement('div');
                    div.className = 'achievement';
                    div.setAttribute('data-achievement-id', achievement.id);
                    div.innerHTML = `
                        <strong>${achievement.name}</strong><br>
                        <small>${achievement.desc}</small>
                    `;
                    achievementsList.appendChild(div);
                }
            });
        }

        function logMessage(message) {
            const gameLog = document.getElementById('game-log');
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.textContent = message;
            gameLog.insertBefore(div, gameLog.firstChild);
            
            // Keep only last 20 log entries
            while (gameLog.children.length > 20) {
                gameLog.removeChild(gameLog.lastChild);
            }
        }

        function gameLoop() {
            // Resource production
            for (let resource in gameState.resourcesProduction) {
                if (gameState.resourcesProduction[resource] > 0) {
                    let production = gameState.resourcesProduction[resource];
                    
                    // Season effects on catnip
                    if (resource === 'catnip') {
                        const seasonMultipliers = [1.5, 1.0, 0.75, 0.25]; // Spring, Summer, Autumn, Winter
                        production *= seasonMultipliers[gameState.stats.season];
                    }
                    
                    // Apply resource caps
                    const currentAmount = gameState.resources[resource];
                    const limit = gameState.resourceLimits[resource] || Infinity;
                    const newAmount = Math.min(limit, currentAmount + production);
                    gameState.resources[resource] = newAmount;
                    
                    // Warn if hitting caps
                    if (newAmount >= limit && Math.random() < 0.01) {
                        logMessage(`⚠️ ${resource} storage is full! Build more storage buildings.`);
                    }
                }
            }
            
            // Season progression (every 60 seconds = 1 season, so 4 minutes = 1 year)
            gameState.stats.timePlayed += 1;
            if (gameState.stats.timePlayed % 60 === 0) {
                const oldSeason = gameState.stats.season;
                gameState.stats.season = (gameState.stats.season + 1) % 4;
                const seasons = ['Spring', 'Summer', 'Autumn', 'Winter'];
                
                if (gameState.stats.season === 0) {
                    gameState.stats.year++;
                    logMessage(`🌸 Year ${gameState.stats.year} begins! Spring has arrived with abundant growth.`);
                } else {
                    logMessage(`${seasons[gameState.stats.season]} has arrived. ${getSeasonMessage()}`);
                }
                checkAchievements();
            }
            
            // Catnip consumption (kittens eat catnip)
            const catnipConsumption = gameState.population.kittens * 0.05; // Reduced consumption
            gameState.resources.catnip = Math.max(0, gameState.resources.catnip - catnipConsumption);
            
            // Happiness calculation
            if (gameState.resources.catnip <= 0) {
                gameState.population.happiness = Math.max(0.1, gameState.population.happiness - 0.002);
                if (gameState.stats.timePlayed % 30 === 0) {
                    logMessage("⚠️ Your kittens are hungry! Catnip supplies are low.");
                }
            } else {
                gameState.population.happiness = Math.min(1.0, gameState.population.happiness + 0.001);
            }
            
            // Random events (less frequent)
            if (Math.random() < 0.0005) { // 0.05% chance per second
                triggerRandomEvent();
            }
            
            updateDisplay();
        }

        function getSeasonMessage() {
            const messages = [
                '', // Spring handled above
                '☀️ Catnip grows normally under the warm sun.',
                '🍂 Catnip production slows as leaves fall.',
                '❄️ Winter reduces catnip growth significantly. Prepare food stores!'
            ];
            return messages[gameState.stats.season];
        }

        function triggerRandomEvent() {
            const events = [
                {
                    message: "A traveling merchant kitten offers to trade!",
                    effect: () => {
                        if (gameState.resources.furs >= 10) {
                            gameState.resources.furs -= 10;
                            gameState.resources.gold += 5;
                            logMessage("You traded 10 furs for 5 gold!");
                        }
                    }
                },
                {
                    message: "Your kittens find a cache of catnip!",
                    effect: () => {
                        const bonus = Math.floor(Math.random() * 50) + 25;
                        gameState.resources.catnip += bonus;
                        logMessage(`Your kittens found ${bonus} catnip!`);
                    }
                },
                {
                    message: "A wise elder cat shares ancient knowledge!",
                    effect: () => {
                        if (gameState.resources.science < 10) {
                            gameState.resources.science += 5;
                            logMessage("The elder's wisdom grants you 5 science!");
                        }
                    }
                },
                {
                    message: "The aurora borealis fills your kittens with wonder!",
                    effect: () => {
                        gameState.resources.faith += 2;
                        logMessage("The beautiful lights inspire faith in Babs!");
                    }
                }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            logMessage(randomEvent.message);
            randomEvent.effect();
        }

        function saveGame() {
            localStorage.setItem('kittenCivilizationSave', JSON.stringify(gameState));
            // Don't log save messages - they're too frequent
        }

        function loadGame() {
            const savedGame = localStorage.getItem('kittenCivilizationSave');
            if (savedGame) {
                gameState = JSON.parse(savedGame);
                logMessage("Game loaded successfully!");
                
                // Show previously unlocked elements
                if (gameState.stats.gatherClicks >= 5) {
                    showElement('plant-catnip-btn');
                }
                if (gameState.stats.gatherClicks >= 3) {
                    showElement('refine-catnip-btn');
                }
                if (gameState.technologies.archery) {
                    showElement('hunt-btn');
                }
                if (gameState.buildings.observatory > 0) {
                    showElement('observe-stars-btn');
                }
                if (gameState.buildings.catnipField > 0) {
                    showElement('field-management');
                }
                
                updateGatherButton();
                updateFieldDisplay();
                
                updateDisplay();
            } else {
                logMessage("No saved game found!");
            }
        }

        function resetGame() {
            if (confirm("Are you sure you want to reset your entire civilization? This cannot be undone!")) {
                localStorage.removeItem('kittenCivilizationSave');
                location.reload();
            }
        }

        // Initialize game
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load saved game
            const savedGame = localStorage.getItem('kittenCivilizationSave');
            if (savedGame) {
                gameState = JSON.parse(savedGame);
                
                // Show previously unlocked elements
                if (gameState.stats.gatherClicks >= 5) {
                    showElement('plant-catnip-btn');
                }
                if (gameState.stats.gatherClicks >= 3) {
                    showElement('refine-catnip-btn');
                }
                if (gameState.technologies.archery) {
                    showElement('hunt-btn');
                }
                if (gameState.buildings.observatory > 0) {
                    showElement('observe-stars-btn');
                }
                
                updateGatherButton();
            }
            
            // Start game loop
            setInterval(gameLoop, 1000); // Run every second
            
            // Auto-save every 30 seconds
            setInterval(saveGame, 30000);
            
            // Initial display update
            updateDisplay();
            
            logMessage("Welcome to Kitten Civilization! Your journey begins...");
        });

        // Add some additional resources to the display when they become available
        function addResourceToDisplay(resourceName, productionName = null) {
            const resourcesDiv = document.getElementById('resources');
            const resourceDiv = document.createElement('div');
            resourceDiv.className = 'resource';
            resourceDiv.innerHTML = `
                <span class="resource-name">${resourceName.charAt(0).toUpperCase() + resourceName.slice(1)}</span>
                <div>
                    <span class="resource-amount" id="${resourceName}-amount">0</span>
                    ${productionName ? `<div class="production-rate" id="${resourceName}-rate">+0.0/sec</div>` : ''}
                </div>
            `;
            resourcesDiv.appendChild(resourceDiv);
        }

        // Monitor for new resources and add them to display
        function checkNewResources() {
            const displayedResources = ['catnip'];
            
            if (gameState.resources.wood > 0 && !document.getElementById('wood-amount')) {
                addResourceToDisplay('wood');
            }
            if (gameState.resources.science > 0 && !document.getElementById('science-amount')) {
                addResourceToDisplay('science', 'science');
            }
            if (gameState.resources.faith > 0 && !document.getElementById('faith-amount')) {
                addResourceToDisplay('faith', 'faith');
            }
            if (gameState.resources.furs > 0 && !document.getElementById('furs-amount')) {
                addResourceToDisplay('furs');
            }
            if (gameState.resources.ivory > 0 && !document.getElementById('ivory-amount')) {
                addResourceToDisplay('ivory');
            }
            if (gameState.resources.gold > 0 && !document.getElementById('gold-amount')) {
                addResourceToDisplay('gold');
            }
            if (gameState.resources.minerals > 0 && !document.getElementById('minerals-amount')) {
                addResourceToDisplay('minerals');
            }
            if (gameState.resources.coal > 0 && !document.getElementById('coal-amount')) {
                addResourceToDisplay('coal');
            }
            if (gameState.resources.iron > 0 && !document.getElementById('iron-amount')) {
                addResourceToDisplay('iron');
            }
            if (gameState.resources.unicorns > 0 && !document.getElementById('unicorns-amount')) {
                addResourceToDisplay('unicorns');
            }
        }

        // Enhanced game loop to check for new resources
        setInterval(checkNewResources, 2000);
    </script>
</body>
</html>