<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future News Archive Generator | AI Ministries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .document-card {
            transition: all 0.3s ease;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-gray-100">
    
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                Future News Archive Generator
            </h1>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                Explore possible futures through interconnected media artifacts. Not predictions—plausible explorations of what could be.
            </p>
            <p class="text-sm text-gray-400 mt-2">Powered by AI Ministries</p>
        </header>

        <!-- Configuration Panel -->
        <div class="bg-slate-800/50 backdrop-blur rounded-lg p-6 mb-8 border border-purple-500/30">
            <h2 class="text-2xl font-semibold mb-6 text-purple-300">Configure Your Future Scenario</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Timeline -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Timeline</label>
                    <select id="timeline" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="2027">Near Future (2027)</option>
                        <option value="2030">Early 2030s</option>
                        <option value="2035">Mid 2030s</option>
                        <option value="2040">2040s</option>
                        <option value="2050">2050s</option>
                        <option value="2075">Far Future (2075+)</option>
                    </select>
                </div>

                <!-- Geoclimate Path -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Geoclimate Path</label>
                    <select id="geoclimate" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="current">Current Trajectory</option>
                        <option value="accelerated">Accelerated Warming</option>
                        <option value="catastrophic">Catastrophic Events</option>
                        <option value="stabilized">Climate Stabilized</option>
                        <option value="ice-age">New Ice Age</option>
                        <option value="asteroid">Asteroid Impact</option>
                    </select>
                </div>

                <!-- Political Climate -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Political Climate</label>
                    <select id="political" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="democratic-erosion">Democratic Erosion</option>
                        <option value="authoritarian">Authoritarian Rise</option>
                        <option value="theocratic">Theocratic Movement</option>
                        <option value="balkanization">Nation Fracturing</option>
                        <option value="global-cooperation">Global Cooperation</option>
                        <option value="technocratic">Technocratic Rule</option>
                        <option value="anarchist">System Collapse</option>
                    </select>
                </div>

                <!-- Economic State -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Economic State</label>
                    <select id="economic" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="collapse">Economic Collapse</option>
                        <option value="depression">Deep Depression</option>
                        <option value="inequality">Extreme Inequality</option>
                        <option value="ubi">Universal Basic Income</option>
                        <option value="post-scarcity">Post-Scarcity Economy</option>
                        <option value="barter">Return to Barter</option>
                    </select>
                </div>

                <!-- Biblical/Prophetic -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Biblical/Prophetic Elements</label>
                    <select id="biblical" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="none">None (Secular)</option>
                        <option value="signs">Signs & Wonders</option>
                        <option value="tribulation">Great Tribulation</option>
                        <option value="antichrist">Antichrist Figure</option>
                        <option value="revelation">Revelation Unfolding</option>
                        <option value="messiah">Messianic Return</option>
                        <option value="judgment">Final Judgment</option>
                    </select>
                </div>

                <!-- Technological -->
                <div>
                    <label class="block text-sm font-medium mb-2 text-gray-300">Technology State</label>
                    <select id="technology" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="current">Current Progress</option>
                        <option value="agi">AGI Achieved</option>
                        <option value="singularity">Technological Singularity</option>
                        <option value="collapse">Tech Collapse</option>
                        <option value="bio-merge">Human-AI Merger</option>
                        <option value="alien-contact">Alien Contact</option>
                    </select>
                </div>

            </div>

            <!-- Custom Event Input -->
            <div class="mt-6">
                <label class="block text-sm font-medium mb-2 text-gray-300">Specific Event or Focus (Optional)</label>
                <input 
                    type="text" 
                    id="customEvent" 
                    placeholder="e.g., 'Second civil war begins', 'Global pandemic returns', 'First Mars colony fails', 'Yellowstone eruption'"
                    class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
            </div>

            <!-- Location -->
            <div class="mt-6">
                <label class="block text-sm font-medium mb-2 text-gray-300">Geographic Focus</label>
                <input 
                    type="text" 
                    id="location" 
                    placeholder="e.g., 'United States', 'Coastal cities', 'Midwest', 'Global'"
                    value="United States"
                    class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
            </div>

            <!-- Image Generation Toggle -->
            <div class="mt-6 bg-slate-700/30 rounded-lg p-4 border border-slate-600">
                <label class="flex items-center gap-3 cursor-pointer">
                    <input 
                        type="checkbox" 
                        id="enableImages"
                        class="w-5 h-5 rounded bg-slate-600 border-slate-500 text-purple-600 focus:ring-2 focus:ring-purple-500"
                    />
                    <div>
                        <span class="text-sm font-medium text-gray-300">Generate Images for Social Media Posts</span>
                        <p class="text-xs text-gray-400 mt-1">⚠️ Experimental: May produce low-quality or blank images. Can slow generation.</p>
                    </div>
                </label>
            </div>

            <!-- Generate Button -->
            <button 
                id="generateBtn"
                class="mt-8 w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500/50"
            >
                Generate Future Archive
            </button>
        </div>

        <!-- History Panel Toggle -->
        <div class="mb-8">
            <button 
                id="historyToggle"
                class="bg-slate-700/50 hover:bg-slate-700 text-purple-300 font-semibold py-3 px-6 rounded-lg transition-all flex items-center gap-2"
            >
                <span>📚</span>
                <span>View Query History</span>
                <span id="historyCount" class="bg-purple-600 text-white text-xs px-2 py-1 rounded-full">0</span>
            </button>
        </div>

        <!-- History Panel (hidden by default) -->
        <div id="historyPanel" class="hidden bg-slate-800/50 backdrop-blur rounded-lg p-6 mb-8 border border-purple-500/30">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold text-purple-300">Query History</h2>
                <button id="closeHistory" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="historyList" class="space-y-4 max-h-96 overflow-y-auto">
                <!-- History items will be inserted here -->
            </div>
        </div>

        <!-- Generation Status -->
        <div id="generationStatus" class="hidden bg-slate-800/50 backdrop-blur rounded-lg p-6 mb-8 border border-blue-500/30">
            <div class="flex items-center gap-4">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"></div>
                <div>
                    <h3 class="text-lg font-semibold text-blue-300">Generating Future Archive...</h3>
                    <p id="statusText" class="text-sm text-gray-400">Analyzing scenario parameters...</p>
                </div>
            </div>
        </div>

        <!-- Archive Results -->
        <div id="archiveResults" class="space-y-6">
            <!-- Documents will appear here -->
        </div>

    </div>

    <script>
        const API_ENDPOINT = 'https://text.pollinations.ai/openai';
        
        // IndexedDB setup
        let db;
        let currentQueryId = null;
        const DB_NAME = 'FutureNewsArchiveDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'queries';
        
        // Initialize IndexedDB
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        objectStore.createIndex('timestamp', 'timestamp', { unique: false });
                        objectStore.createIndex('starred', 'starred', { unique: false });
                    }
                };
            });
        }
        
        // Save query to IndexedDB
        async function saveQuery(queryData) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.add(queryData);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        // Get all queries (most recent first, with starred queries first)
        async function getAllQueries() {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.getAll();
                
                request.onsuccess = () => {
                    const queries = request.result;
                    // Sort: starred first, then by timestamp descending
                    queries.sort((a, b) => {
                        if (a.starred && !b.starred) return -1;
                        if (!a.starred && b.starred) return 1;
                        return b.timestamp - a.timestamp;
                    });
                    resolve(queries);
                };
                request.onerror = () => reject(request.error);
            });
        }
        
        // Toggle star status
        async function toggleStar(id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const getRequest = objectStore.get(id);
                
                getRequest.onsuccess = () => {
                    const query = getRequest.result;
                    query.starred = !query.starred;
                    const updateRequest = objectStore.put(query);
                    updateRequest.onsuccess = () => resolve(query.starred);
                    updateRequest.onerror = () => reject(updateRequest.error);
                };
                getRequest.onerror = () => reject(getRequest.error);
            });
        }
        
        // Delete query
        async function deleteQuery(id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.delete(id);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }
        
        // Get query by ID
        async function getQueryById(id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const objectStore = transaction.objectStore(STORE_NAME);
                const request = objectStore.get(id);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        // Load and display history panel
        async function loadHistoryPanel() {
            const queries = await getAllQueries();
            const historyList = document.getElementById('historyList');
            const historyCount = document.getElementById('historyCount');
            
            // Limit to last 10 regular + all starred
            const starred = queries.filter(q => q.starred);
            const recent = queries.filter(q => !q.starred).slice(0, 10);
            const displayQueries = [...starred, ...recent];
            
            historyCount.textContent = displayQueries.length;
            
            if (displayQueries.length === 0) {
                historyList.innerHTML = '<p class="text-gray-400 text-center py-8">No queries yet. Generate your first future scenario!</p>';
                return;
            }
            
            historyList.innerHTML = displayQueries.map(query => `
                <div class="bg-slate-700/50 rounded-lg p-4 border border-slate-600 hover:border-purple-500 transition-all">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <button 
                                    onclick="toggleQueryStar(${query.id})"
                                    class="text-xl hover:scale-125 transition-transform"
                                >
                                    ${query.starred ? '⭐' : '☆'}
                                </button>
                                <span class="text-sm text-gray-400">
                                    ${new Date(query.timestamp).toLocaleString()}
                                </span>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div><span class="text-gray-400">Timeline:</span> <span class="text-purple-300">${query.params.timeline}</span></div>
                                <div><span class="text-gray-400">Climate:</span> <span class="text-purple-300">${query.params.geoclimate}</span></div>
                                <div><span class="text-gray-400">Political:</span> <span class="text-purple-300">${query.params.political}</span></div>
                                <div><span class="text-gray-400">Tech:</span> <span class="text-purple-300">${query.params.technology}</span></div>
                            </div>
                            ${query.params.customEvent ? `<div class="mt-2 text-sm"><span class="text-gray-400">Event:</span> <span class="text-blue-300">${query.params.customEvent}</span></div>` : ''}
                        </div>
                        <div class="flex gap-2">
                            <button 
                                onclick="loadQuery(${query.id})"
                                class="bg-purple-600 hover:bg-purple-700 text-white text-sm px-3 py-1 rounded transition-all"
                            >
                                Load
                            </button>
                            <button 
                                onclick="deleteQueryFromHistory(${query.id})"
                                class="bg-red-600/50 hover:bg-red-600 text-white text-sm px-3 py-1 rounded transition-all"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500">
                        ${query.documents.length} documents generated
                    </div>
                </div>
            `).join('');
        }
        
        // Toggle star on a query
        async function toggleQueryStar(id) {
            await toggleStar(id);
            await loadHistoryPanel();
        }
        
        // Delete query from history
        async function deleteQueryFromHistory(id) {
            if (confirm('Delete this query from history?')) {
                await deleteQuery(id);
                await loadHistoryPanel();
            }
        }
        
        // Load a previous query
        async function loadQuery(id) {
            const query = await getQueryById(id);
            if (!query) return;
            
            // Close history panel
            document.getElementById('historyPanel').classList.add('hidden');
            
            // Clear current results
            document.getElementById('archiveResults').innerHTML = '';
            
            // Display the documents
            query.documents.forEach((doc, index) => {
                addDocumentToPage(doc.type, doc.content, index);
            });
            
            // Scroll to results
            document.getElementById('archiveResults').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize DB and load history on page load
        initDB().then(() => {
            loadHistoryPanel();
        });
        
        // History panel toggle
        document.getElementById('historyToggle').addEventListener('click', () => {
            document.getElementById('historyPanel').classList.toggle('hidden');
        });
        
        document.getElementById('closeHistory').addEventListener('click', () => {
            document.getElementById('historyPanel').classList.add('hidden');
        });
        
        const documentTypes = [
            { type: 'news', emoji: '📰', label: 'News Article' },
            { type: 'police', emoji: '🚨', label: 'Police Report' },
            { type: 'eyewitness', emoji: '👁️', label: 'Eyewitness Account' },
            { type: 'social', emoji: '💬', label: 'Social Media Thread' },
            { type: 'official', emoji: '📋', label: 'Official Statement' },
            { type: 'scientific', emoji: '🔬', label: 'Scientific Report' },
            { type: 'diary', emoji: '📔', label: 'Personal Diary Entry' },
            { type: 'memo', emoji: '📝', label: 'Internal Memo' }
        ];

        document.getElementById('generateBtn').addEventListener('click', generateArchive);

        async function generateArchive() {
            const timeline = document.getElementById('timeline').value;
            const geoclimate = document.getElementById('geoclimate').value;
            const political = document.getElementById('political').value;
            const economic = document.getElementById('economic').value;
            const biblical = document.getElementById('biblical').value;
            const technology = document.getElementById('technology').value;
            const customEvent = document.getElementById('customEvent').value;
            const location = document.getElementById('location').value;
            const enableImages = document.getElementById('enableImages').checked;

            // Clear previous results
            document.getElementById('archiveResults').innerHTML = '';
            
            // Show status
            const statusDiv = document.getElementById('generationStatus');
            statusDiv.classList.remove('hidden');

            // Build scenario description
            const scenario = buildScenarioDescription(timeline, geoclimate, political, economic, biblical, technology, customEvent, location);

            // Determine number of documents (3-6 based on complexity)
            const numDocs = Math.floor(Math.random() * 4) + 3;
            
            // Select random document types
            const selectedTypes = selectRandomDocTypes(numDocs);
            
            // Store documents for saving to DB
            const generatedDocuments = [];

            // Generate documents one by one
            for (let i = 0; i < numDocs; i++) {
                updateStatus(`Generating document ${i + 1} of ${numDocs}: ${selectedTypes[i].label}...`);
                
                const content = await generateDocument(scenario, selectedTypes[i], i, timeline, customEvent, enableImages);
                generatedDocuments.push({
                    type: selectedTypes[i],
                    content: content
                });
                
                // Small delay between generations
                await sleep(1000);
            }

            // Save to database
            const queryData = {
                timestamp: Date.now(),
                starred: false,
                params: {
                    timeline,
                    geoclimate,
                    political,
                    economic,
                    biblical,
                    technology,
                    customEvent,
                    location,
                    enableImages
                },
                documents: generatedDocuments
            };
            
            currentQueryId = await saveQuery(queryData);
            await loadHistoryPanel();

            // Hide status
            statusDiv.classList.add('hidden');
        }

        function buildScenarioDescription(timeline, geoclimate, political, economic, biblical, technology, customEvent, location) {
            return `Year: ${timeline}
Location: ${location}
Geoclimate: ${geoclimate}
Political Climate: ${political}
Economic State: ${economic}
Biblical/Prophetic Elements: ${biblical}
Technology State: ${technology}
${customEvent ? `Specific Event: ${customEvent}` : ''}

Create an interconnected narrative where these elements influence each other realistically.`;
        }

        function selectRandomDocTypes(num) {
            const shuffled = [...documentTypes].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, num);
        }

        async function generateDocument(scenario, docType, index, timeline, customEvent, enableImages) {
            const prompt = buildDocumentPrompt(scenario, docType, timeline, customEvent);

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'openai-large',
                        max_tokens: 2000,
                        seed: Math.floor(Math.random() * 1000000), // Random seed for unique generation
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a document generator. Output ONLY the requested document with no commentary, explanations, or meta-text. Begin immediately with the document content itself.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                let content = data.choices[0].message.content;

                // Generate images for social media posts if enabled
                if (enableImages && docType.type === 'social') {
                    content = await addImagesToSocialPost(content, scenario, timeline);
                }

                // Add document to page
                addDocumentToPage(docType, content, index);
                
                return content;

            } catch (error) {
                console.error('Error generating document:', error);
                addErrorDocument(docType, index);
                return null;
            }
        }
        
        // Generate and embed images in social media posts
        async function addImagesToSocialPost(content, scenario, timeline) {
            // Extract image prompts that the AI embedded in the content
            const imagePromptRegex = /\[IMAGE_PROMPT:\s*(.+?)\]/g;
            const matches = [...content.matchAll(imagePromptRegex)];
            
            if (matches.length === 0) {
                // No image prompts found, return content as-is
                return content;
            }
            
            let modifiedContent = content;
            
            // Process each image prompt found
            for (let i = 0; i < matches.length && i < 2; i++) {
                const match = matches[i];
                const imagePrompt = match[1].trim();
                const fullMatch = match[0];
                
                try {
                    // Generate image from AI's contextual prompt
                    updateStatus(`Generating contextual image ${i + 1}...`);
                    const imageUrl = await generateImage(imagePrompt);
                    
                    // Replace the [IMAGE_PROMPT: ...] marker with actual image HTML
                    const imageHtml = `\n<img src="${imageUrl}" alt="User shared image" class="rounded-lg mt-2 mb-3 max-w-full h-auto border border-slate-600 shadow-lg" style="max-height: 400px; object-fit: cover;" onerror="this.style.display='none'" />`;
                    
                    modifiedContent = modifiedContent.replace(fullMatch, imageHtml);
                    
                } catch (error) {
                    console.error('Failed to generate image:', error);
                    // Remove the image prompt marker if generation fails
                    modifiedContent = modifiedContent.replace(fullMatch, '');
                }
            }
            
            return modifiedContent;
        }

        
        // Generate image using Pollinations API
        async function generateImage(prompt) {
            // Add timestamp and random seed to ensure unique images every time
            const timestamp = Date.now();
            const randomSeed = Math.floor(Math.random() * 1000000);
            const uniquePrompt = `${prompt}, seed ${randomSeed}`;
            
            // Encode the prompt for URL
            const encodedPrompt = encodeURIComponent(uniquePrompt);
            const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=800&height=600&model=flux&nologo=true&seed=${randomSeed}`;
            
            // Test if image loads with longer timeout for slow generation
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(imageUrl);
                img.onerror = () => reject(new Error('Image failed to load'));
                img.src = imageUrl;
                
                // Timeout after 30 seconds (they can be slow)
                setTimeout(() => reject(new Error('Image load timeout')), 30000);
            });
        }

        function buildDocumentPrompt(scenario, docType, timeline, customEvent) {
            const basePrompt = `CRITICAL INSTRUCTIONS:
- You are a document generator. Output ONLY the document itself.
- DO NOT add any commentary, explanations, or meta-text.
- DO NOT say things like "here's your document" or "alright" or explain what you're doing.
- Start immediately with the document content.
- Write as if you ARE the document, not someone describing it.

SCENARIO CONTEXT:
${scenario}

Write a ${docType.label} that exists in this future world. Make it authentic and grounded in the scenario parameters. Include specific details, names, dates, and interconnections.

BEGIN DOCUMENT NOW:

`;

            const typeSpecificPrompts = {
                news: `Write ONLY the news article (600-800 words). Include:
- Compelling headline
- Byline and date (in ${timeline})
- Lead paragraph summarizing key facts
- Multiple sources quoted
- Context about how situation developed
- What might happen next
Format as a professional news article. NO meta-commentary.`,

                police: `Write ONLY the police incident report. Include:
- Case number and date (in ${timeline})
- Location and time of incident
- Reporting officer name
- Detailed description of events
- Witness statements
- Evidence collected
- Current status
Format as an official police report. NO meta-commentary.`,

                eyewitness: `Write ONLY a first-person eyewitness account (400-600 words). Include:
- When and where they witnessed events
- What they saw, heard, felt
- Their emotional reactions
- Specific sensory details
- What happened before and after
- Their current situation
Make it personal and visceral. NO meta-commentary.`,

                social: `Write ONLY a social media thread (8-12 posts). Show:
- Real-time reactions to events
- Multiple users responding
- Mix of information, speculation, emotion
- Hashtags and viral spread
- Links to news/videos
- Evolving understanding

CRITICAL: If this thread would realistically include photos/images shared by users, include image descriptions in this special format at the END of specific posts:
[IMAGE_PROMPT: detailed description of what photo this user would be sharing, e.g. "photo of flooded downtown street taken from apartment window, cars submerged, people on rooftops"]

Include 1-2 image prompts ONLY where it makes narrative sense (someone witnessing events, sharing evidence, etc).

Format as realistic social media posts with timestamps. NO meta-commentary.`,

                official: `Write ONLY an official government/corporate statement. Include:
- Letterhead/header
- Date (in ${timeline})
- Title/subject line
- Formal language
- Key facts being announced
- Actions being taken
- Contact information
Format as a formal official document. NO meta-commentary.`,

                scientific: `Write ONLY a scientific report excerpt (500-700 words). Include:
- Title and authors
- Date (in ${timeline})
- Abstract/summary
- Key findings
- Data/observations
- Implications
- Technical language appropriate to topic
Format as academic/scientific writing. NO meta-commentary.`,

                diary: `Write ONLY a personal diary entry (400-600 words). Include:
- Date (in ${timeline})
- Personal reflections on events
- How their life has changed
- Fears and hopes
- Observations about society
- Raw, honest emotions
Format as intimate personal writing. NO meta-commentary.`,

                memo: `Write ONLY an internal memo (300-500 words). Include:
- To/From/Date (in ${timeline})
- Subject line
- Situation overview
- Concerns or recommendations
- Confidential information
- Next steps
Format as internal corporate/government communication. NO meta-commentary.`
            };

            return basePrompt + typeSpecificPrompts[docType.type];
        }

        function addDocumentToPage(docType, content, index) {
            const resultsDiv = document.getElementById('archiveResults');
            
            const docCard = document.createElement('div');
            docCard.className = 'document-card bg-slate-800/50 backdrop-blur rounded-lg p-6 border border-slate-700 fade-in-up';
            docCard.style.animationDelay = `${index * 0.1}s`;
            
            docCard.innerHTML = `
                <div class="flex items-center gap-3 mb-4 pb-4 border-b border-slate-700">
                    <span class="text-3xl">${docType.emoji}</span>
                    <div>
                        <h3 class="text-xl font-semibold text-purple-300">${docType.label}</h3>
                        <p class="text-sm text-gray-400">Generated ${new Date().toLocaleString()}</p>
                    </div>
                </div>
                <div class="prose prose-invert prose-slate max-w-none whitespace-pre-wrap">
                    ${formatContent(content)}
                </div>
            `;
            
            resultsDiv.appendChild(docCard);
        }

        function formatContent(content) {
            // Preserve line breaks and basic formatting
            return content
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/^# (.+)$/gm, '<h2 class="text-2xl font-bold mt-4 mb-2">$1</h2>')
                .replace(/^## (.+)$/gm, '<h3 class="text-xl font-semibold mt-3 mb-2">$1</h3>');
        }

        function addErrorDocument(docType, index) {
            const resultsDiv = document.getElementById('archiveResults');
            
            const docCard = document.createElement('div');
            docCard.className = 'document-card bg-red-900/20 backdrop-blur rounded-lg p-6 border border-red-700 fade-in-up';
            docCard.style.animationDelay = `${index * 0.1}s`;
            
            docCard.innerHTML = `
                <div class="flex items-center gap-3 mb-4">
                    <span class="text-3xl">⚠️</span>
                    <div>
                        <h3 class="text-xl font-semibold text-red-300">Error Generating ${docType.label}</h3>
                        <p class="text-sm text-gray-400">Could not generate this document. Try again.</p>
                    </div>
                </div>
            `;
            
            resultsDiv.appendChild(docCard);
        }

        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>

</body>
</html>